<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Mist","version":"7.8.0","exturl":false,"sidebar":{"position":"right","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="expressjs 学习笔记及中文API（摘自网络）">
<meta property="og:type" content="article">
<meta property="og:title" content="express">
<meta property="og:url" content="http://example.com/2017/07/24/express/index.html">
<meta property="og:site_name" content="XFNOTES">
<meta property="og:description" content="expressjs 学习笔记及中文API（摘自网络）">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2017-07-24T00:28:56.000Z">
<meta property="article:modified_time" content="2018-01-07T11:40:14.000Z">
<meta property="article:author" content="xuefeng">
<meta property="article:tag" content="javascript">
<meta property="article:tag" content="node.js">
<meta property="article:tag" content="入门">
<meta property="article:tag" content="language">
<meta property="article:tag" content="基础">
<meta property="article:tag" content="express">
<meta property="article:tag" content="文档">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://example.com/2017/07/24/express/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>express | XFNOTES</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">XFNOTES</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-ategories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>ategories</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2017/07/24/express/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="xuefeng">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="XFNOTES">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          express
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2017-07-24 08:28:56" itemprop="dateCreated datePublished" datetime="2017-07-24T08:28:56+08:00">2017-07-24</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2018-01-07 19:40:14" itemprop="dateModified" datetime="2018-01-07T19:40:14+08:00">2018-01-07</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/node-js/" itemprop="url" rel="index"><span itemprop="name">node.js</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>expressjs 学习笔记及中文API（摘自网络）</p>
<a id="more"></a>

<h1 id="Express-4-x-API"><a href="#Express-4-x-API" class="headerlink" title="Express 4.x API"></a>Express 4.x API</h1><p><a target="_blank" rel="noopener" href="https://github.com/bajian/express_api_4.x_chinese">updated by github@bajian</a><br>标签（空格分隔）： express 翻译 api文档 中文</p>
<hr>
<h2 id="express"><a href="#express" class="headerlink" title="express()"></a>express()</h2><p><code>express()</code>用来创建一个Express的程序。<code>express()</code>方法是**<em>express**</em>模块导出的顶层方法。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> app = express();</span><br></pre></td></tr></table></figure>

<h3 id="Methods"><a href="#Methods" class="headerlink" title="Methods"></a>Methods</h3><h4 id="express-static-root-options"><a href="#express-static-root-options" class="headerlink" title="express.static(root, [options])"></a>express.static(root, [options])</h4><p><code>express.static</code>是Express中唯一的内建中间件。它以<a target="_blank" rel="noopener" href="https://github.com/expressjs/serve-static">server-static</a>模块为基础开发，负责托管 Express 应用内的静态资源。<br>参数<code>root</code>为静态资源的所在的根目录。<br>参数<code>options</code>是可选的，支持以下的属性：</p>
<table>
<thead>
<tr>
<th align="center">属性</th>
<th align="center">描述</th>
<th align="center">类型</th>
<th align="center">默认值</th>
</tr>
</thead>
<tbody><tr>
<td align="center">dotfiles</td>
<td align="center">是否响应点文件。供选择的值有”allow”，”deny”和”ignore”</td>
<td align="center">String</td>
<td align="center">“ignore”</td>
</tr>
<tr>
<td align="center">etag</td>
<td align="center">使能或者关闭etag</td>
<td align="center">Boolean</td>
<td align="center">true</td>
</tr>
<tr>
<td align="center">extensions</td>
<td align="center">设置文件延期回退</td>
<td align="center">Boolean</td>
<td align="center">true</td>
</tr>
<tr>
<td align="center">index</td>
<td align="center">发送目录索引文件。设置false将不发送。</td>
<td align="center">Mixed</td>
<td align="center">“index.html”</td>
</tr>
<tr>
<td align="center">lastModified</td>
<td align="center">设置文件在系统中的最后修改时间到<code>Last-Modified</code>头部。可能的取值有<code>false</code>和<code>true</code>。</td>
<td align="center">Boolean</td>
<td align="center">true</td>
</tr>
<tr>
<td align="center">maxAge</td>
<td align="center">在Cache-Control头部中设置<code>max-age</code>属性，精度为毫秒(ms)或则一段<a target="_blank" rel="noopener" href="https://www.npmjs.org/package/ms">ms format</a>的字符串</td>
<td align="center">Number</td>
<td align="center">0</td>
</tr>
<tr>
<td align="center">redirect</td>
<td align="center">当请求的pathname是一个目录的时候，重定向到尾随”/“</td>
<td align="center">Boolean</td>
<td align="center">true</td>
</tr>
<tr>
<td align="center">setHeaders</td>
<td align="center">当响应静态文件请求时设置headers的方法</td>
<td align="center">Funtion</td>
<td align="center">&nbsp;</td>
</tr>
</tbody></table>
<p>如果你想获得更多关于使用中间件的细节，你可以查阅<a target="_blank" rel="noopener" href="http://expressjs.com/starter/static-files.html">Serving static files in Express</a>。</p>
<h2 id="Application"><a href="#Application" class="headerlink" title="Application()"></a>Application()</h2><p><code>app</code>对象一般用来表示Express程序。通过调用Express模块导出的顶层的<code>express()</code>方法来创建它:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> app = express();</span><br><span class="line"></span><br><span class="line">app.get(<span class="string">&#x27;/&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">    res.send(<span class="string">&#x27;hello world!&#x27;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.listen(<span class="number">3000</span>);</span><br></pre></td></tr></table></figure>
<p><code>app</code>对象具有以下的方法：</p>
<ul>
<li> 路由HTTP请求；具体可以看<a target="_blank" rel="noopener" href="http://expressjs.com/4x/api.html#app.METHOD">app.METHOD</a>和<a target="_blank" rel="noopener" href="http://expressjs.com/4x/api.html#app.param">app.param</a>这两个例子。</li>
<li> 配置中间件；具体请看<a target="_blank" rel="noopener" href="http://expressjs.com/4x/api.html#app.route">app.route</a>。</li>
<li> 渲染HTML视图；具体请看<a target="_blank" rel="noopener" href="http://expressjs.com/4x/api.html#app.render">app.render</a>。</li>
<li> 注册模板引擎；具体请看<a target="_blank" rel="noopener" href="http://expressjs.com/4x/api.html#app.engine">app.engine</a>。</li>
</ul>
<p>它还有一些属性设置，这些属性可以改变程序的行为。获得更多的信息，可以查阅<a target="_blank" rel="noopener" href="http://expressjs.com/4x/api.html#app.settings.table">Application settings</a>。</p>
<h3 id="Properties"><a href="#Properties" class="headerlink" title="Properties"></a>Properties</h3><h4 id="app-locals"><a href="#app-locals" class="headerlink" title="app.locals"></a>app.locals</h4><p><code>app.locals</code>对象是一个javascript对象，它的属性就是程序本地的变量。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">app.locals.title</span><br><span class="line"><span class="comment">// =&gt; &#x27;My App&#x27;</span></span><br><span class="line"></span><br><span class="line">app.locals.email</span><br><span class="line"><span class="comment">// =&gt; &#x27;me@myapp.com&#x27;</span></span><br></pre></td></tr></table></figure>
<p>一旦设定，<code>app.locals</code>的各属性值将贯穿程序的整个生命周期，与其相反的是<code>res.locals</code>，它只在这次请求的生命周期中有效。</p>
<p>在程序中，你可以在渲染模板时使用这些本地变量。它们是非常有用的，可以为模板提供一些有用的方法，以及<code>app</code>级别的数据。通过<code>req.app.locals</code>(具体查看<a target="_blank" rel="noopener" href="http://expressjs.com/4x/api.html#req.app">req.app</a>)，Locals可以在中间件中使用。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">app.locals.title = <span class="string">&#x27;My App&#x27;</span>;</span><br><span class="line">app.locals.strftime = <span class="built_in">require</span>(<span class="string">&#x27;strftime&#x27;</span>);</span><br><span class="line">app.locals.email = <span class="string">&#x27;me@myapp.com&#x27;</span>;</span><br></pre></td></tr></table></figure>

<h4 id="app-mountpath"><a href="#app-mountpath" class="headerlink" title="app.mountpath"></a>app.mountpath</h4><p><code>app.mountpath</code>属性是子程序挂载的路径模式。</p>
<blockquote>
<p>一个子程序是一个<code>express</code>的实例，其可以被用来作为路由句柄来处理请求。</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> app = express(); <span class="comment">// the main app</span></span><br><span class="line"><span class="keyword">var</span> admin = express(); <span class="comment">// the sub app</span></span><br><span class="line">admin.get(<span class="string">&#x27;/&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(admin.mountpath); <span class="comment">// /admin</span></span><br><span class="line">    res.send(<span class="string">&#x27;Admin Homepage&#x27;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.use(<span class="string">&#x27;/admin&#x27;</span>, admin); <span class="comment">// mount the sub app</span></span><br></pre></td></tr></table></figure>
<p>它和req对象的<a target="_blank" rel="noopener" href="http://expressjs.com/4x/api.html#req.baseUrl">baseUrl</a>属性比较相似，除了<code>req.baseUrl</code>是匹配的URL路径，而不是匹配的模式。如果一个子程序被挂载在多条路径模式，<code>app.mountpath</code>就是一个关于挂载路径模式项的列表，如下面例子所示。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&#96;&#96;&#96;js</span><br><span class="line">var admin &#x3D; express();</span><br><span class="line">admin.get(&#39;&#x2F;&#39;, function(req, res) &#123;</span><br><span class="line">    console.log(admin.mountpath); &#x2F;&#x2F; [&#39;adm*n&#39;, &#39;&#x2F;manager&#39;] </span><br><span class="line">    res.send(&#39;Admin Homepage&#39;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">var secret &#x3D; express();</span><br><span class="line">secret.get(&#39;&#x2F;&#39;, function(req, res) &#123;</span><br><span class="line">    console.log(secret.mountpath); &#x2F;&#x2F; &#x2F;secr*t</span><br><span class="line">    res.send(&#39;Admin secret&#39;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">admin.use(&#39;secr*t&#39;, secret); &#x2F;&#x2F; load the &#39;secret&#39; router on &#39;&#x2F;secr*t&#39;, on the &#39;admin&#39; sub app</span><br><span class="line">app.use([&#39;&#x2F;adm*n&#39;, &#39;&#x2F;manager&#39;], admin); &#x2F;&#x2F; load the &#39;admin&#39; router on &#39;&#x2F;adm*n&#39; and  &#39;&#x2F;manager&#39; , on the parent app</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="Events"><a href="#Events" class="headerlink" title="Events"></a>Events</h3><h4 id="app-on-‘mount’-callback-parent"><a href="#app-on-‘mount’-callback-parent" class="headerlink" title="app.on(‘mount’, callback(parent))"></a>app.on(‘mount’, callback(parent))</h4><p>当子程序被挂载到父程序时，<code>mount</code>事件被发射。父程序对象作为参数，传递给回调方法。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> admin = express();</span><br><span class="line">admin.on(<span class="string">&#x27;mount&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">parent</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;Admin Mounted&#x27;</span>);</span><br><span class="line">    <span class="built_in">console</span>.log(parent); <span class="comment">// refers to the parent app</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">admin.get(<span class="string">&#x27;/&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">    res.send(<span class="string">&#x27;Admin Homepage&#x27;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.use(<span class="string">&#x27;/admin&#x27;</span>, admin);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="Methods-1"><a href="#Methods-1" class="headerlink" title="Methods"></a>Methods</h3><h4 id="app-all-path-callback-callback-…"><a href="#app-all-path-callback-callback-…" class="headerlink" title="app.all(path, callback[, callback …]"></a>app.all(path, callback[, callback …]</h4><p><code>app.all</code>方法和标准的<code>app.METHOD()</code>方法相似，除了它匹配所有的HTTP动词。<br>对于给一个特殊前缀映射一个全局的逻辑处理，或者无条件匹配，它是很有效的。例如，如果你把下面内容放在所有其他的路由定义的前面，它要求所有从这个点开始的路由需要认证和自动加载一个用户。记住这些回调并不是一定是终点:<code>loadUser</code>可以在完成了一个任务后，调用<code>next()</code>方法来继续匹配随后的路由。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">app.all(<span class="string">&#x27;*&#x27;</span>, requireAuthentication, loadUser);</span><br></pre></td></tr></table></figure>
<p>或者这种相等的形式:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">app.all(<span class="string">&#x27;*&#x27;</span>, requireAuthentication);</span><br><span class="line">app.all(<span class="string">&#x27;*&#x27;</span>, loadUser);</span><br></pre></td></tr></table></figure>
<p>另一个例子是全局的白名单方法。这个例子和前面的很像，然而它只是限制以<code>/api</code>开头的路径。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">app.all(<span class="string">&#x27;/api/*&#x27;</span>, requireAuthentication);</span><br></pre></td></tr></table></figure>

<h4 id="app-delete-path-callback-callback-…"><a href="#app-delete-path-callback-callback-…" class="headerlink" title="app.delete(path, callback[, callback …])"></a>app.delete(path, callback[, callback …])</h4><p>路由<code>HTTP DELETE</code>请求到有特殊回调方法的特殊的路径。获取更多的信息，可以查阅<a target="_blank" rel="noopener" href="http://expressjs.com/guide/routing.html">routing guide</a>。<br>你可以提供多个回调函数，它们的行为和中间件一样，除了这些回调可以通过调用<code>next(&#39;router&#39;)</code>来绕过剩余的路由回调。你可以使用这个机制来为一个路由设置一些前提条件，如果不能满足当前路由的处理条件，那么你可以传递控制到随后的路由。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">app.delete(<span class="string">&#x27;/&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">    res.send(<span class="string">&#x27;DELETE request to homepage&#x27;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h4 id="app-disable-name"><a href="#app-disable-name" class="headerlink" title="app.disable(name)"></a>app.disable(name)</h4><p>设置类型为布尔的设置名为<code>name</code>的值为<code>false</code>，此处的<code>name</code>是<a target="_blank" rel="noopener" href="http://expressjs.com/4x/api.html#app.settings.table">app settings table</a>中各属性的一个。调用<code>app.set(&#39;foo&#39;, false)</code>和调用<code>app.disable(&#39;foo&#39;)</code>是等价的。<br>比如:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">app.disable(<span class="string">&#x27;trust proxy&#x27;</span>);</span><br><span class="line">app.get(<span class="string">&#x27;trust proxy&#x27;</span>);</span><br><span class="line"><span class="comment">// =&gt; false</span></span><br></pre></td></tr></table></figure>
<h4 id="app-disabled-name"><a href="#app-disabled-name" class="headerlink" title="app.disabled(name)"></a>app.disabled(name)</h4><p>返回<code>true</code>如果布尔类型的设置值<code>name</code>被禁用为<code>false</code>，此处的<code>name</code>是<a target="_blank" rel="noopener" href="http://expressjs.com/4x/api.html#app.settings.table">app settings table</a>中各属性的一个。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">app.disabled(<span class="string">&#x27;trust proxy&#x27;</span>);</span><br><span class="line"><span class="comment">// =&gt; true</span></span><br><span class="line">app.enable(<span class="string">&#x27;trust proxy&#x27;</span>);</span><br><span class="line">app.disabled(<span class="string">&#x27;trust proxy&#x27;</span>);</span><br><span class="line"><span class="comment">// =&gt; false</span></span><br></pre></td></tr></table></figure>

<h4 id="app-enable-name"><a href="#app-enable-name" class="headerlink" title="app.enable(name)"></a>app.enable(name)</h4><p>设置布尔类型的设置值<code>name</code>为<code>true</code>，此处的<code>name</code>是<a target="_blank" rel="noopener" href="http://expressjs.com/4x/api.html#app.settings.table">app settings table</a>中各属性的一个。调用<code>app.set(&#39;foo&#39;, true)</code>和调用<code>app.enable(&#39;foo&#39;)</code>是等价的。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">app.enable(<span class="string">&#x27;trust proxy&#x27;</span>);</span><br><span class="line">app.get(<span class="string">&#x27;trust proxy&#x27;</span>);</span><br><span class="line"><span class="comment">// =&gt; true</span></span><br></pre></td></tr></table></figure>
<h4 id="app-enabled-name"><a href="#app-enabled-name" class="headerlink" title="app.enabled(name)"></a>app.enabled(name)</h4><p>返回<code>true</code>如果布尔类型的设置值<code>name</code>被启动为<code>true</code>，此处的<code>name</code>是<a target="_blank" rel="noopener" href="http://expressjs.com/4x/api.html#app.settings.table">app settings table</a>中各属性的一个。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">app.enabled(<span class="string">&#x27;trust proxy&#x27;</span>);</span><br><span class="line"><span class="comment">// =&gt; false</span></span><br><span class="line">app.enable(<span class="string">&#x27;trust proxy&#x27;</span>);</span><br><span class="line">app.enabled(<span class="string">&#x27;trust proxy&#x27;</span>);</span><br><span class="line"><span class="comment">// =&gt; true</span></span><br></pre></td></tr></table></figure>

<h4 id="app-engine-ext-callback"><a href="#app-engine-ext-callback" class="headerlink" title="app.engine(ext, callback)"></a>app.engine(ext, callback)</h4><p>注册给定引擎的回调，用来渲染处理ext文件。<br>默认情况下，Express需要使用<code>require()</code>来加载基于文件扩展的引擎。例如，如果你尝试渲染一个<code>foo.jade</code>文件，Express在内部调用下面的内容，同时缓存<code>require()</code>结果供随后的调用，来加速性能。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">app.engine(<span class="string">&#x27;jade&#x27;</span>, <span class="built_in">require</span>(<span class="string">&#x27;jade&#x27;</span>).__express);</span><br></pre></td></tr></table></figure>
<p>使用下面的方法对于那些没有提供开箱即用的<code>.__express</code>方法的模板，或者你希望使用不同的模板引擎扩展。<br>比如，使用EJS模板引擎来渲染<code>.html</code>文件：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">app.engine(<span class="string">&#x27;html&#x27;</span>, <span class="built_in">require</span>(<span class="string">&#x27;ejs&#x27;</span>).renderFile);</span><br></pre></td></tr></table></figure>
<p>在这个例子中，EJS提供了一个<code>.renderFile</code>方法，这个方法满足了Express规定的签名规则：<code>(path, options, callback)</code>，然而记住在内部它只是<code>ejs.__express</code>的一个别名，所以你可以在不做任何事的情况下直接使用<code>.ejs</code>扩展。<br>一些模板引擎没有遵循这种规范，<a target="_blank" rel="noopener" href="https://github.com/tj/consolidate.js">consolidate.js</a>库映射模板引擎以下面的使用方式，所以他们可以无缝的和Express工作。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> engines = <span class="built_in">require</span>(<span class="string">&#x27;consolidate&#x27;</span>);</span><br><span class="line">app.engine(<span class="string">&#x27;haml&#x27;</span>, engines.haml);</span><br><span class="line">app.engine(<span class="string">&#x27;html&#x27;</span>, engines.hogan);</span><br></pre></td></tr></table></figure>
<h4 id="app-get-name"><a href="#app-get-name" class="headerlink" title="app.get(name)"></a>app.get(name)</h4><p>获得设置名为<code>name</code>的app设置的值，此处的<code>name</code>是<a target="_blank" rel="noopener" href="http://expressjs.com/4x/api.html#app.settings.table">app settings table</a>中各属性的一个。<br>如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">app.get(<span class="string">&#x27;title&#x27;</span>);</span><br><span class="line"><span class="comment">// =&gt; undefined</span></span><br><span class="line"></span><br><span class="line">app.set(<span class="string">&#x27;title&#x27;</span>, <span class="string">&#x27;My Site&#x27;</span>);</span><br><span class="line">app.get(<span class="string">&#x27;title&#x27;</span>);</span><br><span class="line"><span class="comment">// =&gt; &#x27;My Site&#x27;</span></span><br></pre></td></tr></table></figure>

<h4 id="app-get-path-callback-callback-…"><a href="#app-get-path-callback-callback-…" class="headerlink" title="app.get(path, callback [, callback …])"></a>app.get(path, callback [, callback …])</h4><p>路由<code>HTTP GET</code>请求到有特殊回调的特殊路径。获取更多的信息，可以查阅<a target="_blank" rel="noopener" href="http://expressjs.com/guide/routing.html">routing guide</a>。<br>你可以提供多个回调函数，它们的行为和中间件一样，除了这些回调可以通过调用<code>next(&#39;router&#39;)</code>来绕过剩余的路由回调。你可以使用这个机制来为一个路由设置一些前提条件，如果请求没能满足当前路由的处理条件，那么传递控制到随后的路由。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">app.get(<span class="string">&#x27;/&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">    res.send(<span class="string">&#x27;GET request to homepage&#x27;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h4 id="app-listen-port-hostname-backlog-callback"><a href="#app-listen-port-hostname-backlog-callback" class="headerlink" title="app.listen(port, [hostname], [backlog], [callback])"></a>app.listen(port, [hostname], [backlog], [callback])</h4><p>绑定程序监听端口到指定的主机和端口号。这个方法和<code>Node</code>中的<a target="_blank" rel="noopener" href="http://nodejs.org/api/http.html#http_server_listen_port_hostname_backlog_callback">http.Server.listen()</a>是一样的。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> app = express();</span><br><span class="line">app.listen(<span class="number">3000</span>);</span><br></pre></td></tr></table></figure>
<p>通过调用<code>express()</code>返回得到的<code>app</code>实际上是一个JavaScript的<code>Function</code>，被设计用来作为一个回调传递给<code>Node HTTP servers</code>来处理请求。这样，其就可以很简便的基于同一份代码提供http和https版本，所以app没有从这些继承(它只是一个简单的回调)。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> https = <span class="built_in">require</span>(<span class="string">&#x27;https&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">&#x27;http&#x27;</span>);</span><br><span class="line"></span><br><span class="line">http.createServer(app).listen(<span class="number">80</span>);</span><br><span class="line">https.createServer(options, app).listen(<span class="number">443</span>);</span><br></pre></td></tr></table></figure>
<p><code>app.listen()</code>方法是下面所示的一个便利的方法(只针对HTTP协议):</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">app.listen = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> server = http.createServer(<span class="built_in">this</span>);</span><br><span class="line">    <span class="keyword">return</span> server.listen.apply(server, <span class="built_in">arguments</span>);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h4 id="app-METHOD-path-callback-callback-…"><a href="#app-METHOD-path-callback-callback-…" class="headerlink" title="app.METHOD(path, callback [, callback …])"></a>app.METHOD(path, callback [, callback …])</h4><p>路由一个HTTP请求，<code>METHOD</code>是这个请求的HTTP方法，比如<code>GET</code>，<code>PUT</code>，<code>POST</code>等等，注意是小写的。所以，实际的方法是<code>app.get()</code>，<code>app.post()</code>，<code>app.put()</code>等等。下面有关于方法的完整的表。<br>获取更多信息，请看<a target="_blank" rel="noopener" href="http://expressjs.com/guide/routing.html">routing guide</a>。<br>Express支持下面的路由方法，对应与同名的HTTP方法：</p>
<table style="border:0px;background:node">
    <tbody>
        <tr>
            <td style="background:none;border:0px;">
                <ul>
                <li>checkout</li>
                <li>connect</li>
                <li>copy</li>
                <li>delete</li>
                <li>get</li>
                <li>head</li>
                <li>lock</li>
                <li>merge</li>
                <li>mkactivity</li>
                <ul>
            </td>
            <td style="background:none;border:0px;">
               <ul>
                <li>mkcol</li>
                <li>move</li>
                <li>m-search</li>
                <li>notify</li>
                <li>options</li>
                <li>patch</li>
                <li>post</li>
                <li>propfind</li>
                <li>proppatch</li>
                <ul>
            </td>
                        <td style="background:none;border:0px;">
               <ul>
                <li>purege</li>
                <li>put</li>
                <li>report</li>
                <li>search</li>
                <li>subscribe</li>
                <li>trace</li>
                <li>unlock</li>
                <li>unsubscribe</li>
                <ul>
            </td>
        <tr>
    </tbody>
</table>

<blockquote>
<p>如果使用上述方法时，导致了无效的javascript的变量名，可以使用中括号符号，比如,<code>app[&#39;m-search&#39;](&#39;/&#39;, function ...</code></p>
</blockquote>
<p>你可以提供多个回调函数，它们的行为和中间件一样，除了这些回调可以通过调用<code>next(&#39;router&#39;)</code>来绕过剩余的路由回调。你可以使用这个机制来为一个路由设置一些前提条件，如果请求没有满足当前路由的处理条件，那么传递控制到随后的路由。</p>
<blockquote>
<p>本API文档把使用比较多的HTTP方法<code>app.get()</code>，<code>app.post</code>，<code>app.put()</code>，<code>app.delete()</code>作为一个个单独的项进行说明。然而，其他上述列出的方法以完全相同的方式工作。</p>
</blockquote>
<p><code>app.all()</code>是一个特殊的路由方法，它不属于HTTP协议中的规定的方法。它为一个路径加载中间件，其对所有的请求方法都有效。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">app.all(<span class="string">&#x27;/secret&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;Accessing the secret section...&#x27;</span>);</span><br><span class="line">    next(); <span class="comment">// pass control to the next handler</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h4 id="app-param-name-callback"><a href="#app-param-name-callback" class="headerlink" title="app.param([name], callback)"></a>app.param([name], callback)</h4><p>给路由参数添加回调触发器，这里的<code>name</code>是参数名或者参数数组，<code>function</code>是回调方法。回调方法的参数按序是<code>请求对象</code>，<code>响应对象</code>，<code>下个中间件</code>，<code>参数值</code>和<code>参数名</code>。<br>如果<code>name</code>是数组，会按照各个参数在数组中被声明的顺序将回调触发器注册下来。还有，对于除了最后一个参数的其他参数，在他们的回调中调用<code>next()</code>来调用下个声明参数的回调。对于最后一个参数，在回调中调用<code>next()</code>将调用位于当前处理路由中的下一个中间件，如果<code>name</code>只是一个<code>string</code>那就和它是一样的(就是说只有一个参数，那么就是最后一个参数，和数组中最后一个参数是一样的)。<br>例如，当<code>:user</code>出现在路由路径中，你可以映射用户加载的逻辑处理来自动提供<code>req.user</code>给这个路由，或者对输入的参数进行验证。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">app.param(<span class="string">&#x27;user&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">req, res, next, id</span>) </span>&#123;</span><br><span class="line">    User.find(id, <span class="function"><span class="keyword">function</span>(<span class="params">error, user</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (err) &#123;</span><br><span class="line">            next(err);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (user)&#123;</span><br><span class="line">            req.user = user;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            next(<span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&#x27;failed to load user&#x27;</span>));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>对于<code>Param</code>的回调定义的路由来说，他们是局部的。它们不会被挂载的app或者路由继承。所以，定义在<code>app</code>上的<code>Param</code>回调只有是在<code>app</code>上的路由具有这个路由参数时才起作用。<br>在定义<code>param</code>的路由上，<code>param</code>回调都是第一个被调用的，它们在一个请求-响应循环中都会被调用一次并且只有一次，即使多个路由都匹配，如下面的例子：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">app.param(<span class="string">&#x27;id&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">req, res, next, id</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;CALLED ONLY ONCE&#x27;</span>);</span><br><span class="line">    next();</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.get(<span class="string">&#x27;/user/:id&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">req, res, next</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;although this matches&#x27;</span>);</span><br><span class="line">    next();</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.get(<span class="string">&#x27;/user/:id&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;and this mathces too&#x27;</span>);</span><br><span class="line">    res.end();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>当<code>GET /user/42</code>，得到下面的结果:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">CALLED ONLY ONCE</span><br><span class="line">although this matches</span><br><span class="line">and this matches too</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">app.param([<span class="string">&#x27;id&#x27;</span>, <span class="string">&#x27;page&#x27;</span>], <span class="function"><span class="keyword">function</span>(<span class="params">req, res, next, value</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;CALLED ONLY ONCE with&#x27;</span>, value);</span><br><span class="line">    next();</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.get(<span class="string">&#x27;/user/:id/:page&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">req. res, next</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;although this matches&#x27;</span>);</span><br><span class="line">    next();</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.get(<span class="string">&#x27;/user/:id/:page&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req, res, next</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;and this matches too&#x27;</span>);</span><br><span class="line">    res.end();</span><br><span class="line">&#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>当执行<code>GET /user/42/3</code>，结果如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">CALLED ONLY ONCE with 42</span><br><span class="line">CALLED ONLY ONCE with 3</span><br><span class="line">although this matches</span><br><span class="line">and this mathes too</span><br></pre></td></tr></table></figure>
<blockquote>
<p>下面章节描述的<code>app.param(callback)</code>在v4.11.0之后被弃用。</p>
</blockquote>
<p>通过只传递一个回调参数给<code>app.param(name, callback)</code>方法，<code>app.param(naem, callback)</code>方法的行为将被完全改变。这个回调参数是关于<code>app.param(name, callback)</code>该具有怎样的行为的一个自定义方法，这个方法必须接受两个参数并且返回一个中间件。<br>这个回调的第一个参数就是需要捕获的url的参数名，第二个参数可以是任一的JavaScript对象，其可能在实现返回一个中间件时被使用。<br>这个回调方法返回的中间件决定了当URL中包含这个参数时所采取的行为。<br>在下面的例子中，<code>app.param(name, callback)</code>参数签名被修改成了<code>app.param(name, accessId)</code>。替换接受一个参数名和回调，<code>app.param()</code>现在接受一个参数名和一个数字。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> app = express();</span><br><span class="line"></span><br><span class="line">app.param(<span class="function"><span class="keyword">function</span>(<span class="params">param, option</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params">req, res, next, val</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (val == option) &#123;</span><br><span class="line">            next();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            res.sendStatus(<span class="number">403</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.param(<span class="string">&#x27;id&#x27;</span>, <span class="number">1337</span>);</span><br><span class="line"></span><br><span class="line">app.get(<span class="string">&#x27;/user/:id&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">    res.send(<span class="string">&#x27;Ok&#x27;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.listen(<span class="number">3000</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;Ready&#x27;</span>);</span><br><span class="line">&#125;); </span><br></pre></td></tr></table></figure>
<p>在这个例子中，<code>app.param(name, callback)</code>参数签名保持和原来一样，但是替换成了一个中间件，定义了一个自定义的数据类型检测方法来检测<code>user id</code>的类型正确性。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">app.param(<span class="function"><span class="keyword">function</span>(<span class="params">param, validator</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params">req, res, next, val</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (validator(val)) &#123;</span><br><span class="line">            next();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            res.sendStatus(<span class="number">403</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.param(<span class="string">&#x27;id&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">candidate</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> !<span class="built_in">isNaN</span>(<span class="built_in">parseFloat</span>(candidate)) &amp;&amp; <span class="built_in">isFinite</span>(candidate);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<blockquote>
<p>在使用正则表达式来，不要使用<code>.</code>。例如，你不能使用<code>/user-.+/</code>来捕获<code>user-gami</code>，用使用<code>[\\s\\S]</code>或者<code>[\\w\\&gt;W]</code>来代替(正如<code>/user-[\\s\\S]+/</code>)。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;captures &#39;1-a_6&#39; but not &#39;543-azser-sder&#39;</span><br><span class="line">router.get(&#39;&#x2F;[0-9]+-[[\\w]]*&#39;, function); </span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;captures &#39;1-a_6&#39; and &#39;543-az(ser&quot;-sder&#39; but not &#39;5-a s&#39;</span><br><span class="line">router.get(&#39;&#x2F;[0-9]+-[[\\S]]*&#39;, function); </span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;captures all (equivalent to &#39;.*&#39;)</span><br><span class="line">router.get(&#39;[[\\s\\S]]*&#39;, function); </span><br></pre></td></tr></table></figure>
</blockquote>
<h4 id="app-path"><a href="#app-path" class="headerlink" title="app.path()"></a>app.path()</h4><p>通过这个方法可以得到<code>app</code>典型的路径，其是一个<code>string</code>。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> app = express()</span><br><span class="line">  , blog = express()</span><br><span class="line">  , blogAdmin = express();</span><br><span class="line"></span><br><span class="line">app.use(<span class="string">&#x27;/blog&#x27;</span>, blog);</span><br><span class="line">app.use(<span class="string">&#x27;/admin&#x27;</span>, blogAdmin);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(app.path()); <span class="comment">// &#x27;&#x27;</span></span><br><span class="line"><span class="built_in">console</span>.log(blog.path()); <span class="comment">// &#x27;/blog&#x27;</span></span><br><span class="line"><span class="built_in">console</span>.log(blogAdmin.path()); <span class="comment">// &#x27;/blog/admin&#x27;</span></span><br></pre></td></tr></table></figure>
<p>如果<code>app</code>挂载很复杂下，那么这个方法的行为也会很复杂：一种更好用的方式是使用<code>req.baseUrl</code>来获得这个app的典型路径。</p>
<h4 id="app-post-path-callback-callback-…"><a href="#app-post-path-callback-callback-…" class="headerlink" title="app.post(path, callback, [callback …])"></a>app.post(path, callback, [callback …])</h4><p>路由<code>HTTP POST</code>请求到有特殊回调的特殊路径。获取更多的信息，可以查阅<a target="_blank" rel="noopener" href="http://expressjs.com/guide/routing.html">routing guide</a>。<br>你可以提供多个回调函数，它们的行为和中间件一样，除了这些回调可以通过调用<code>next(&#39;router&#39;)</code>来绕过剩余的路由回调。你可以使用这个机制来为一个路由设置一些前提条件，如果请求没能满足当前路由的处理条件，那么传递控制到随后的路由。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">app.post(<span class="string">&#x27;/&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">    res.send(<span class="string">&#x27;POST request to homepage&#x27;</span>)</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h4 id="app-put-path-callback-callback-…"><a href="#app-put-path-callback-callback-…" class="headerlink" title="app.put(path, callback, [callback …])"></a>app.put(path, callback, [callback …])</h4><p>路由<code>HTTP PUT</code>请求到有特殊回调的特殊路径。获取更多的信息，可以查阅<a target="_blank" rel="noopener" href="http://expressjs.com/guide/routing.html">routing guide</a>。<br>你可以提供多个回调函数，它们的行为和中间件一样，除了这些回调可以通过调用<code>next(&#39;router&#39;)</code>来绕过剩余的路由回调。你可以使用这个机制来为一个路由设置一些前提条件，如果请求没能满足当前路由的处理条件，那么传递控制到随后的路由。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">app.put(<span class="string">&#x27;/&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">    res.send(<span class="string">&#x27;PUT request to homepage&#x27;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h4 id="app-render-view-locals-callback"><a href="#app-render-view-locals-callback" class="headerlink" title="app.render(view, [locals], callback)"></a>app.render(view, [locals], callback)</h4><p>通过<code>callback</code>回调返回一个<code>view</code>渲染之后得到的HTML文本。它可以接受一个可选的参数，可选参数包含了这个<code>view</code>需要用到的本地数据。这个方法类似于<code>res.render()</code>，<strong>除了它不能把渲染得到的HTML文本发送给客户端</strong>。</p>
<blockquote>
<p>将<code>app.render()</code>当作是可以生成渲染视图字符串的工具方法。在<code>res.render()</code>内部，就是使用的<code>app.render()</code>来渲染视图。</p>
</blockquote>
<blockquote>
<p>如果使能了视图缓存，那么本地变量缓存就会保留。如果你想在开发的过程中缓存视图，设置它为<code>true</code>。在生产环境中，视图缓存默认是打开的。</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">app.render(<span class="string">&#x27;email&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">err, html</span>) </span>&#123;</span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.render(<span class="string">&#x27;email&#x27;</span>, &#123;<span class="attr">name</span>:<span class="string">&#x27;Tobi&#x27;</span>&#125;, <span class="function"><span class="keyword">function</span>(<span class="params">err, html</span>) </span>&#123;</span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h4 id="app-route-path"><a href="#app-route-path" class="headerlink" title="app.route(path)"></a>app.route(path)</h4><p>返回一个单例模式的路由的实例，之后你可以在其上施加各种HTTP动作的中间件。使用<code>app.route()</code>来避免重复路由名字(例如错字错误)–说的意思应该是使用<code>app.router()</code>这个单例方法来避免同一个路径多个路由实例。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> app = express();</span><br><span class="line"></span><br><span class="line">app.route(<span class="string">&#x27;/events&#x27;</span>)</span><br><span class="line">.all(<span class="function"><span class="keyword">function</span>(<span class="params">req, res, next</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// runs for all HTTP verbs first</span></span><br><span class="line">  <span class="comment">// think of it as route specific middleware!</span></span><br><span class="line">&#125;)</span><br><span class="line">.get(<span class="function"><span class="keyword">function</span>(<span class="params">req, res, next</span>) </span>&#123;</span><br><span class="line">  res.json(...);</span><br><span class="line">&#125;)</span><br><span class="line">.post(<span class="function"><span class="keyword">function</span>(<span class="params">req, res, next</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// maybe add a new event...</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="app-set-name-value"><a href="#app-set-name-value" class="headerlink" title="app.set(name, value)"></a>app.set(name, value)</h4><p>给<code>name</code>设置项赋<code>value</code>值，<code>name</code>是<a target="_blank" rel="noopener" href="http://expressjs.com/4x/api.html#app.settings.table">app settings table</a>中属性的一项。<br>对于一个类型是布尔型的属性调用<code>app.set(&#39;foo&#39;, ture)</code>等价于调用<code>app.enable(&#39;foo&#39;)</code>。同样的，调用<code>app.set(&#39;foo&#39;, false)</code>等价于调用<code>app.disable(&#39;foo&#39;)</code>。<br>可以使用<code>app.get()</code>来取得设置的值：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">app.set(<span class="string">&#x27;title&#x27;</span>, <span class="string">&#x27;My Site&#x27;</span>);</span><br><span class="line">app.get(<span class="string">&#x27;title&#x27;</span>); <span class="comment">// &#x27;My Site&#x27;</span></span><br></pre></td></tr></table></figure>
<p><strong>Application Settings</strong><br>如果<code>name</code>是程序设置之一，它将影响到程序的行为。下边列出了程序中的设置。</p>
<table>
<thead>
<tr>
<th align="center">属性</th>
<th align="center">类型</th>
<th align="center">值</th>
<th align="center">默认</th>
</tr>
</thead>
<tbody><tr>
<td align="center">case sensitive routing</td>
<td align="center">Boolean</td>
<td align="center">启用区分大小写。</td>
<td align="center">不启用。对<code>/Foo</code>和<code>/foo</code>处理是一样。</td>
</tr>
<tr>
<td align="center">env</td>
<td align="center">String</td>
<td align="center">环境模型。</td>
<td align="center">process.env.NODE_ENV(NODE_ENV环境变量)或者”development”</td>
</tr>
<tr>
<td align="center">etag</td>
<td align="center">Varied</td>
<td align="center">设置<code>ETag</code>响应头。可取的值，可以查阅<a target="_blank" rel="noopener" href="http://expressjs.com/4x/api.html#etag.options.table">etag options table</a>。更多关于<a target="_blank" rel="noopener" href="http://en.wikipedia.org/wiki/HTTP_ETag">HTTP ETag header</a>。</td>
<td align="center">weak</td>
</tr>
<tr>
<td align="center">jsonp callback name</td>
<td align="center">String</td>
<td align="center">指定默认JSONP回调的名称。</td>
<td align="center">?callback=</td>
</tr>
<tr>
<td align="center">json replacer</td>
<td align="center">String</td>
<td align="center">JSON替代品回调</td>
<td align="center">null</td>
</tr>
<tr>
<td align="center">json spaces</td>
<td align="center">Number</td>
<td align="center">当设置了这个值后，发送缩进空格美化过的JSON字符串。</td>
<td align="center">Disabled</td>
</tr>
<tr>
<td align="center">query parser</td>
<td align="center">Varied</td>
<td align="center">设置值为<code>false</code>来禁用<code>query parser</code>，或者设置<code>simple</code>,<code>extended</code>，也可以自己实现<code>query string</code>解析函数。<code>simple</code>基于<code>Node</code>原生的<code>query</code>解析，<a target="_blank" rel="noopener" href="http://nodejs.org/api/querystring.html">querystring</a>。</td>
<td align="center">“extend”</td>
</tr>
<tr>
<td align="center">strict routing</td>
<td align="center">Boolean</td>
<td align="center">启用严格的路由。</td>
<td align="center">不启用。对<code>/foo</code>和<code>/foo/</code>的路由处理是一样。</td>
</tr>
<tr>
<td align="center">subdomain offset</td>
<td align="center">Number</td>
<td align="center">用来删除访问子域的主机点分部分的个数</td>
<td align="center">2</td>
</tr>
<tr>
<td align="center">trust proxy</td>
<td align="center">Varied</td>
<td align="center">指示<code>app</code>在一个反向代理的后面，使用<code>x-Forwarded-*</code>来确定连接和客户端的IP地址。注意:<code>X-Forwarded-*</code>头部很容易被欺骗，所有检测客户端的IP地址是靠不住的。<code>trust proxy</code>默认不启用。当启用时，Express尝试通过前端代理或者一系列代理来获取已连接的客户端IP地址。<code>req.ips</code>属性包含了已连接客户端IP地址的一个数组。为了启动它，需要设置在下面<a target="_blank" rel="noopener" href="http://expressjs.com/4x/api.html#trust.proxy.options.table">trust proxy options table</a>中定义的值。<code>trust proxy</code>的设置实现使用了<code>proxy-addr</code>包。如果想获得更多的信息，可以查阅它的文档</td>
<td align="center">Disable</td>
</tr>
<tr>
<td align="center">views</td>
<td align="center">String or Array</td>
<td align="center"><code>view</code>所在的目录或者目录数组。如果是一个数组，将按在数组中的顺序来查找<code>view</code>。</td>
<td align="center">process.cwd() + ‘/views’</td>
</tr>
<tr>
<td align="center">view cache</td>
<td align="center">Boolean</td>
<td align="center">启用视图模板编译缓存。</td>
<td align="center">在生成环境默认开启。</td>
</tr>
<tr>
<td align="center">view engine</td>
<td align="center">String</td>
<td align="center">省略时，默认的引擎被扩展使用。</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">x-powered-by</td>
<td align="center">Boolean</td>
<td align="center">启用<code>X-Powered-By:Express</code>HTTP头部</td>
<td align="center">true</td>
</tr>
</tbody></table>
<p><strong>Options for <code>trust proxy</code> settings</strong><br>查阅<a target="_blank" rel="noopener" href="http://expressjs.com/guide/behind-proxies.html">Express behind proxies</a>来获取更多信息。</p>
<table>
<thead><tr><th>Type</th><th>Value</th></tr></thead>
<tbody>
<tr>
<td>Boolean</td>
<td>
<p>如果为<code>true</code>，客户端的IP地址作为<code>X-Forwarded-*</code>头部的最左边的条目。如果为<code>false</code>，可以理解为<code>app</code>直接与英特网直连，客户端的IP地址衍生自<code>req.connection.remoteAddress</code>。<code>false</code>是默认设置。</p>
</td>
</tr>
<tr>
<td>IP addresses</td>
<td>
<p>一个IP地址，子网，或者一组IP地址，和委托子网。下面列出的是一个预先配置的子网名列表。</p>
<ul>
<li>loopback - <code>127.0.0.1/8</code>, <code>::1/128</code></li>
<li>linklocal - <code>169.254.0.0/16</code>, <code>fe80::/10</code></li>
<li>uniquelocal - <code>10.0.0.0/8</code>, <code>172.16.0.0/12</code>, <code>192.168.0.0/16</code>, <code>fc00::/7</code></li>
</ul>
<p>使用下面方法中的任何一种来设置IP地址:</p>
<pre class="  language-javascript"><code class="  language-javascript">app<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span><span class="token string">'trust proxy'</span><span class="token punctuation">,</span> <span class="token string">'loopback'</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// specify a single subnet
</span>  app<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span><span class="token string">'trust proxy'</span><span class="token punctuation">,</span> <span class="token string">'loopback, 123.123.123.123'</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// specify a subnet and an address
</span>  app<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span><span class="token string">'trust proxy'</span><span class="token punctuation">,</span> <span class="token string">'loopback, linklocal, uniquelocal'</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// specify multiple subnets as CSV
</span>  app<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span><span class="token string">'trust proxy'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'loopback'</span><span class="token punctuation">,</span> <span class="token string">'linklocal'</span><span class="token punctuation">,</span> <span class="token string">'uniquelocal'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// specify multiple subnets as an array</span></code></pre>
<p>当指定IP地址之后, 这个IP地址或子网会被设置了这个IP地址或子网的`app`排除在外, 最靠近程序服务的没有委托的地址将被看做客户端IP地址。</p>
</td>
</tr>
<tr>
<td>Number</td>
<td>
<p>信任从反向代理到app中间小于等于n跳的连接为客户端。</p>
</td>
</tr>
<tr>
<td>Function</td>
<td>
<p>客户自定义委托代理信任机制。如果你使用这个，请确保你自己知道你在干什么。</p>
<pre class="  language-javascript"><code class="  language-javascript">app<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span><span class="token string">'trust proxy'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>ip<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>ip <span class="token operator">===</span> <span class="token string">'127.0.0.1'</span> <span class="token operator">||</span> ip <span class="token operator">===</span> <span class="token string">'123.123.123.123'</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token keyword">true</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// trusted IPs
</span>    <span class="token keyword">else</span> <span class="token keyword">return</span> <span class="token keyword">false</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span></code></pre>
</td>
</tr>
</tbody>
</table>

<p><strong>Options for <code>etag</code> settings</strong><br><code>ETag</code>功能的实现使用了<a target="_blank" rel="noopener" href="https://www.npmjs.org/package/etag">etag</a>包。如果你需要获得更多的信息，你可以查阅它的文档。</p>
<table>
<thead><tr><th>Type</th><th>Value</th></tr></thead>
<tbody>
<tr>
<td>Boolean</td>
<td>
<p>设置为<code>true</code>，启用weak ETag。这个是默认设置。设置<code>false</code>，禁用所有的ETag。<br>
</td>
</tr>
<tr>
<td>String</td>
<td>
如果是<code>strong</code>，使能strong ETag。如果是<code>weak</code>，启用<code>weak</code> ETag。
</td>
</tr>
<tr>
<td>Function</td>
<td>
<p>客户自定义`ETag`方法的实现. 如果你使用这个，请确保你自己知道你在干什么。</p>
<pre class="  language-javascript"><code class="  language-javascript">app<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span><span class="token string">'etag'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>body<span class="token punctuation">,</span> encoding<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> <span class="token function">generateHash<span class="token punctuation">(</span></span>body<span class="token punctuation">,</span> encoding<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// consider the function is defined
</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span></code></pre>
</td>
</tr>
</tbody>
</table>

<h4 id="app-use-path-function-function…"><a href="#app-use-path-function-function…" class="headerlink" title="app.use([path,], function [, function…])"></a>app.use([path,], function [, function…])</h4><p>挂载<a target="_blank" rel="noopener" href="http://expressjs.com/guide/using-middleware.html">中间件</a>方法到路径上。如果路径未指定，那么默认为”/“。</p>
<blockquote>
<p>一个路由将匹配任何路径如果这个路径以这个路由设置路径后紧跟着”/“。比如：<code>app.use(&#39;/appale&#39;, ...)</code>将匹配”/apple”，”/apple/images”，”/apple/images/news”等。</p>
</blockquote>
<blockquote>
<p>中间件中的<code>req.originalUrl</code>是<code>req.baseUrl</code>和<code>req.path</code>的组合，如下面的例子所示。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&gt;app.use(&#39;&#x2F;admin&#39;, function(req, res, next) &#123;</span><br><span class="line">&gt;&#x2F;&#x2F; GET &#39;http:&#x2F;&#x2F;www.example.com&#x2F;admin&#x2F;new&#39;</span><br><span class="line">&gt;console.log(req.originalUrl); &#x2F;&#x2F; &#39;&#x2F;admin&#x2F;new&#39;</span><br><span class="line">&gt;console.log(req.baseUrl); &#x2F;&#x2F; &#39;&#x2F;admin&#39;</span><br><span class="line">&gt;console.log(req.path);&#x2F;&#x2F; &#39;&#x2F;new&#39;</span><br><span class="line">&gt;&#125;);</span><br></pre></td></tr></table></figure>
</blockquote>
<p>在一个路径上挂载一个中间件之后，每当请求的路径的前缀部分匹配了这个路由路径，那么这个中间件就会被执行。<br>由于默认的路径为<code>/</code>，中间件挂载没有指定路径，那么对于每个请求，这个中间件都会被执行。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// this middleware will be executed for every request to the app.</span></span><br><span class="line">app.use(<span class="function"><span class="keyword">function</span>(<span class="params">req, res, next</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;Time: %d&#x27;</span>, <span class="built_in">Date</span>.now());</span><br><span class="line">    next();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>中间件方法是顺序处理的，所以中间件包含的顺序是很重要的。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// this middleware will not allow the request to  go beyond it</span></span><br><span class="line">app.use(<span class="function"><span class="keyword">function</span>(<span class="params">req, res, next</span>) </span>&#123;</span><br><span class="line">    res.send(<span class="string">&#x27;Hello World&#x27;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// this middleware will never reach this route</span></span><br><span class="line">app.use(<span class="string">&#x27;/&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">    res.send(<span class="string">&#x27;Welcome&#x27;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>路径可以是代表路径的一串字符，一个路径模式，一个匹配路径的正则表达式，或者他们的一组集合。</p>
<blockquote>
<p>下面是路径的简单的例子。</p>
</blockquote>
<table>
<thead>
<tr>
<th> Type </th>
<th> Example </th>
</tr>
</thead>
<tbody>
<tr>
<td>Path</td>
<td>
<pre class="  language-javascript"><code class="  language-javascript"><span class="token comment" spellcheck="true">// will match paths starting with /abcd
</span>app<span class="token punctuation">.</span><span class="token function">use<span class="token punctuation">(</span></span><span class="token string">'/abcd'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token function">next<span class="token punctuation">(</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span></code></pre>
</td>
</tr>
<tr>
<td>Path Pattern</td>
<td>
<pre class="  language-javascript"><code class="  language-javascript"><span class="token comment" spellcheck="true">// will match paths starting with /abcd and /abd
</span>app<span class="token punctuation">.</span><span class="token function">use<span class="token punctuation">(</span></span><span class="token string">'/abc?d'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token function">next<span class="token punctuation">(</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span>

<p><span class="token comment" spellcheck="true">// will match paths starting with /abcd, /abbcd, /abbbbbcd and so on<br></span>app<span class="token punctuation">.</span><span class="token function">use<span class="token punctuation">(</span></span><span class="token string">‘/ab+cd’</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><br>  <span class="token function">next<span class="token punctuation">(</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">&#125;</span><span class="token punctuation">)</span></p>
<p><span class="token comment" spellcheck="true">// will match paths starting with /abcd, /abxcd, /abFOOcd, /abbArcd and so on<br></span>app<span class="token punctuation">.</span><span class="token function">use<span class="token punctuation">(</span></span><span class="token string">‘/ab*cd’</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><br>  <span class="token function">next<span class="token punctuation">(</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">&#125;</span><span class="token punctuation">)</span></p>
<p><span class="token comment" spellcheck="true">// will match paths starting with /ad and /abcd<br></span>app<span class="token punctuation">.</span><span class="token function">use<span class="token punctuation">(</span></span><span class="token string">‘/a(bc)?d’</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><br>  <span class="token function">next<span class="token punctuation">(</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">&#125;</span><span class="token punctuation">)</span></code></pre></p>
</td>
</tr>
<tr>
<td>Regular Expression</td>
<td>
<pre class="  language-javascript"><code class="  language-javascript"><span class="token comment" spellcheck="true">// will match paths starting with /abc and /xyz
</span>app<span class="token punctuation">.</span><span class="token function">use<span class="token punctuation">(</span></span><span class="token regex">/\/abc|\/xyz/</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token function">next<span class="token punctuation">(</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span></code></pre>
</td>
</tr>
<tr>
<td>Array</td>
<td>
<pre class="  language-javascript"><code class="  language-javascript"><span class="token comment" spellcheck="true">// will match paths starting with /abcd, /xyza, /lmn, and /pqr
</span>app<span class="token punctuation">.</span><span class="token function">use<span class="token punctuation">(</span></span><span class="token punctuation">[</span><span class="token string">'/abcd'</span><span class="token punctuation">,</span> <span class="token string">'/xyza'</span><span class="token punctuation">,</span> <span class="token operator">/</span>\<span class="token operator">/</span>lmn<span class="token operator">|</span>\<span class="token operator">/</span>pqr<span class="token operator">/</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token function">next<span class="token punctuation">(</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span></code></pre>
</td>
</tr>
</tbody>
</table>

<p>方法可以是一个中间件方法，一系列中间件方法，一组中间件方法或者他们的集合。由于<code>router</code>和<code>app</code>实现了中间件接口，你可以像使用其他任一中间件方法那样使用它们。</p>
<table>
<thead>
<tr>
<th>Usage</th>
<th>Example</th>
</tr>
</thead>
<tbody>
<tr>
<td>单个中间件</td>
<td>你可以局部定义和挂载一个中间件。
<pre class="  language-javascript"><code class="  language-javascript">app<span class="token punctuation">.</span><span class="token function">use<span class="token punctuation">(</span></span><span class="token keyword">function</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token function">next<span class="token punctuation">(</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
</code></pre>
一个<code>router</code>是有效的中间件。
<pre class="  language-javascript"><code class="  language-javascript"><span class="token keyword">var</span> router <span class="token operator">=</span> express<span class="token punctuation">.</span><span class="token function">Router<span class="token punctuation">(</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
router<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token function">next<span class="token punctuation">(</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
app<span class="token punctuation">.</span><span class="token function">use<span class="token punctuation">(</span></span>router<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
一个<code>Express</code>程序是一个有效的中间件。
<pre class="  language-javascript"><code class="  language-javascript"><span class="token keyword">var</span> subApp <span class="token operator">=</span> <span class="token function">express<span class="token punctuation">(</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
subApp<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token function">next<span class="token punctuation">(</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
app<span class="token punctuation">.</span><span class="token function">use<span class="token punctuation">(</span></span>subApp<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
</td>
</tr>
<tr>
<td>一系列中间件</td>
<td>
对于一个相同的挂载路径，你可以挂载超过一个的中间件。
<pre class="  language-javascript"><code class="  language-javascript"><span class="token keyword">var</span> r1 <span class="token operator">=</span> express<span class="token punctuation">.</span><span class="token function">Router<span class="token punctuation">(</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
r1<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token function">next<span class="token punctuation">(</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span>

<p><span class="token keyword">var</span> r2 <span class="token operator">=</span> express<span class="token punctuation">.</span><span class="token function">Router<span class="token punctuation">(</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>r2<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">‘/‘</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><br>  <span class="token function">next<span class="token punctuation">(</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">&#125;</span><span class="token punctuation">)</span></p>
<p>app<span class="token punctuation">.</span><span class="token function">use<span class="token punctuation">(</span></span>r1<span class="token punctuation">,</span> r2<span class="token punctuation">)</span><span class="token punctuation">;</span><br></code></pre></p>
</td>
</tr>
<tr>
<td>一组中间件</td>
<td>
在逻辑上使用一个数组来组织一组中间件。如果你传递一组中间件作为第一个或者唯一的参数，接着你需要指定挂载的路径。
<pre class="  language-javascript"><code class="  language-javascript"><span class="token keyword">var</span> r1 <span class="token operator">=</span> express<span class="token punctuation">.</span><span class="token function">Router<span class="token punctuation">(</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
r1<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token function">next<span class="token punctuation">(</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span>

<p><span class="token keyword">var</span> r2 <span class="token operator">=</span> express<span class="token punctuation">.</span><span class="token function">Router<span class="token punctuation">(</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>r2<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">‘/‘</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><br>  <span class="token function">next<span class="token punctuation">(</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">&#125;</span><span class="token punctuation">)</span></p>
<p>app<span class="token punctuation">.</span><span class="token function">use<span class="token punctuation">(</span></span><span class="token string">‘/‘</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>r1<span class="token punctuation">,</span> r2<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br></code></pre></p>
</td>
</tr>
<tr>
<td>组合</td>
<td>
你可以组合下面的所有方法来挂载中间件。
<pre class="  language-javascript"><code class="  language-javascript"><span class="token keyword">function</span> <span class="token function">mw1<span class="token punctuation">(</span></span>req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token function">next<span class="token punctuation">(</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span>
<span class="token keyword">function</span> <span class="token function">mw2<span class="token punctuation">(</span></span>req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token function">next<span class="token punctuation">(</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span>

<p><span class="token keyword">var</span> r1 <span class="token operator">=</span> express<span class="token punctuation">.</span><span class="token function">Router<span class="token punctuation">(</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>r1<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">‘/‘</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token function">next<span class="token punctuation">(</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></p>
<p><span class="token keyword">var</span> r2 <span class="token operator">=</span> express<span class="token punctuation">.</span><span class="token function">Router<span class="token punctuation">(</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>r2<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">‘/‘</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token function">next<span class="token punctuation">(</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></p>
<p><span class="token keyword">var</span> subApp <span class="token operator">=</span> <span class="token function">express<span class="token punctuation">(</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>subApp<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">‘/‘</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token function">next<span class="token punctuation">(</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></p>
<p>app<span class="token punctuation">.</span><span class="token function">use<span class="token punctuation">(</span></span>mw1<span class="token punctuation">,</span> <span class="token punctuation">[</span>mw2<span class="token punctuation">,</span> r1<span class="token punctuation">,</span> r2<span class="token punctuation">]</span><span class="token punctuation">,</span> subApp<span class="token punctuation">)</span><span class="token punctuation">;</span><br></code></pre></p>
</td>
</tr>
</tbody>
</table>

<p>下面是一些例子，在<code>Express</code>程序中使用<code>express.static</code>中间件。<br>为程序托管位于程序目录下的<code>public</code>目录下的静态资源：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// GET /style.css etc</span></span><br><span class="line">app.use(express.static(__dirname + <span class="string">&#x27;/public&#x27;</span>));</span><br></pre></td></tr></table></figure>
<p>在<code>/static</code>路径下挂载中间件来提供静态资源托管服务，只当请求是以<code>/static</code>为前缀的时候。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// GET /static/style.css etc.</span></span><br><span class="line">app.use(<span class="string">&#x27;/static&#x27;</span>, express.static(express.__dirname + <span class="string">&#x27;/public&#x27;</span>));</span><br></pre></td></tr></table></figure>
<p>通过在设置静态资源中间件之后加载日志中间件来关闭静态资源请求的日志。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">app.use(express.static(__dirname + <span class="string">&#x27;/public&#x27;</span>));</span><br><span class="line">app.use(logger());</span><br></pre></td></tr></table></figure>
<p>托管静态资源从不同的路径，但<code>./public</code>路径比其他更容易被匹配：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">app.use(express.static(__dirname + <span class="string">&#x27;/public&#x27;</span>));</span><br><span class="line">app.use(express.static(__dirname + <span class="string">&#x27;/files&#x27;</span>));</span><br><span class="line">app.use(express.static(__dirname + <span class="string">&#x27;/uploads&#x27;</span>));</span><br></pre></td></tr></table></figure>

<h2 id="Request"><a href="#Request" class="headerlink" title="Request"></a>Request</h2><p><code>req</code>对象代表了一个HTTP请求，其具有一些属性来保存请求中的一些数据，比如<code>query string</code>，<code>parameters</code>，<code>body</code>，<code>HTTP headers</code>等等。在本文档中，按照惯例，这个对象总是简称为<code>req</code>(http响应简称为<code>res</code>)，但是它们实际的名字由这个回调方法在那里使用时的参数决定。<br>如下例子:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">app.get(<span class="string">&#x27;/user/:id&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">    res.send(<span class="string">&#x27;user&#x27;</span> + req.params.id);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>其实你也可以这样写：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">app.get(<span class="string">&#x27;/user/:id&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">request, response</span>) </span>&#123;</span><br><span class="line">    response.send(<span class="string">&#x27;user&#x27;</span> + request.params.id);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="Properties-1"><a href="#Properties-1" class="headerlink" title="Properties"></a>Properties</h3><p>在<code>Express 4</code>中，<code>req.files</code>默认在<code>req</code>对象中不再是可用的。为了通过<code>req.files</code>对象来获得上传的文件，你可以使用一个<code>multipart-handling</code>(多种处理的工具集)中间件，比如<code>busboy</code>，<code>multer</code>，<code>formidable</code>，<code>multipraty</code>，<code>connect-multiparty</code>或者<code>pez</code>。</p>
<h4 id="req-app"><a href="#req-app" class="headerlink" title="req.app"></a>req.app</h4><p>这个属性持有<code>express</code>程序实例的一个引用，其可以作为中间件使用。<br>如果你按照这个模式，你创建一个模块导出一个中间件，这个中间件只在你的主文件中<code>require()</code>它，那么这个中间件可以通过<code>req.app</code>来获取express的实例。<br>例如:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// index.js</span></span><br><span class="line">app.get(<span class="string">&quot;/viewdirectory&quot;</span>, <span class="built_in">require</span>(<span class="string">&#x27;./mymiddleware.js&#x27;</span>));</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// mymiddleware.js</span></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="keyword">function</span>(<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">    res.send(<span class="string">&#x27;The views directory is &#x27;</span> + req.app.get(<span class="string">&#x27;views&#x27;</span>));</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h4 id="req-baseUrl"><a href="#req-baseUrl" class="headerlink" title="req.baseUrl"></a>req.baseUrl</h4><p>一个路由实例挂载的Url路径。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> greet = express.Router();</span><br><span class="line">greet.get(<span class="string">&#x27;/jp&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(req.baseUrl); <span class="comment">// greet</span></span><br><span class="line">    res.send(<span class="string">&#x27;Konichiwa!&#x27;</span>);</span><br><span class="line">&#125;);</span><br><span class="line">app.use(<span class="string">&#x27;/greet&#x27;</span>, greet);</span><br></pre></td></tr></table></figure>
<p>即使你使用的路径模式或者一系列路径模式来加载路由，<code>baseUrl</code>属性返回匹配的字符串，而不是路由模式。下面的例子，<code>greet</code>路由被加载在两个路径模式上。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">app.use([<span class="string">&#x27;/gre+t&#x27;</span>, <span class="string">&#x27;hel&#123;2&#125;o&#x27;</span>], greet); <span class="comment">// load the on router on &#x27;/gre+t&#x27; and &#x27;/hel&#123;2&#125;o&#x27;</span></span><br></pre></td></tr></table></figure>
<p>当一个请求路径是<code>/greet/jp</code>，<code>baseUrl</code>是<code>/greet</code>，当一个请求路径是<code>/hello/jp</code>，<code>req.baseUrl</code>是<code>/hello</code>。<br><code>req.baseUrl</code>和<code>app</code>对象的<a target="_blank" rel="noopener" href="http://expressjs.com/4x/api.html#app.mountpath">mountpath</a>属性相似，除了<code>app.mountpath</code>返回的是路径匹配模式。</p>
<h4 id="req-body"><a href="#req-body" class="headerlink" title="req.body"></a>req.body</h4><p>在请求的body中保存的是提交的一对对键值数据。默认情况下，它是<code>undefined</code>，当你使用比如<code>body-parser</code>和<code>multer</code>这类解析<code>body</code>数据的中间件时，它是填充的。<br>下面的例子，给你展示了怎么使用<code>body-parser</code>中间件来填充<code>req.body</code>。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> app = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> bodyParser = <span class="built_in">require</span>(<span class="string">&#x27;body-parser&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> multer = <span class="built_in">require</span>(<span class="string">&#x27;multer&#x27;</span>)；<span class="comment">// v1.0.5</span></span><br><span class="line"><span class="keyword">var</span> upload = multer(); <span class="comment">// for parsing multipart/form-data</span></span><br><span class="line">app.use(bodyParser.json()); <span class="comment">// for parsing application/json</span></span><br><span class="line">app.use(bodyParser.urlencoded(&#123;<span class="attr">extended</span>:<span class="literal">true</span>&#125;)); <span class="comment">// for parsing application/x-www-form-urlencoded</span></span><br><span class="line"></span><br><span class="line">app.post(<span class="string">&#x27;/profile&#x27;</span>, upload.array(), <span class="function"><span class="keyword">function</span>(<span class="params">req, res, next</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(req.body);</span><br><span class="line">    res.json(req.body);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h4 id="req-cookies"><a href="#req-cookies" class="headerlink" title="req.cookies"></a>req.cookies</h4><p>当使用<code>cookie-parser</code>中间件的时候，这个属性是一个对象，其包含了请求发送过来的<code>cookies</code>。如果请求没有带<code>cookies</code>，那么其值为<code>&#123;&#125;</code>。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Cookie: name=tj</span></span><br><span class="line">req.cookies.name</span><br><span class="line"><span class="comment">// =&gt; &quot;tj&quot;</span></span><br></pre></td></tr></table></figure>
<p>获取更多信息，问题，或者关注，可以查阅<a target="_blank" rel="noopener" href="https://github.com/expressjs/cookie-parser">cookie-parser</a>。</p>
<h4 id="req-fresh"><a href="#req-fresh" class="headerlink" title="req.fresh"></a>req.fresh</h4><p>指示这个请求是否是新鲜的。其和<code>req.stale</code>是相反的。<br>当<code>cache-control</code>请求头没有<code>no-cache</code>指示和下面中的任一一个条件为<code>true</code>，那么其就为<code>true</code>：</p>
<ul>
<li><code>if-modified-since</code>请求头被指定，和<code>last-modified</code>请求头等于或者早于<code>modified</code>响应头。</li>
<li><code>if-none-match</code>请求头是<code>*</code>。</li>
<li><code>if-none-match</code>请求头在被解析进它的指令之后，和<code>etag</code>响应头的值不相等</li>
</ul>
<blockquote>
<p>ps:If-None-Match作用: If-None-Match和ETag一起工作，工作原理是在HTTP Response中添加ETag信息。 当用户再次请求该资源时，将在HTTP Request 中加入If-None-Match信息(ETag的值)。如果服务器验证资源的ETag没有改变（该资源没有更新），将返回一个304状态告诉客户端使用本地缓存文件。否则将返回200状态和新的资源和Etag.  使用这样的机制将提高网站的性能</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">req.fresh</span><br><span class="line"><span class="comment">// =&gt; true</span></span><br></pre></td></tr></table></figure>

<h4 id="req-hostname"><a href="#req-hostname" class="headerlink" title="req.hostname"></a>req.hostname</h4><p>包含了源自<code>Host</code>HTTP头部的<code>hostname</code>。<br>当<code>trust proxy</code>设置项被设置为启用值，<code>X-Forwarded-Host</code>头部被使用来代替<code>Host</code>。这个头部可以被客户端或者代理设置。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; Host: &quot;example.com&quot;</span><br><span class="line">req.hostname</span><br><span class="line">&#x2F;&#x2F; &#x3D;&gt; &quot;example.com&quot;</span><br></pre></td></tr></table></figure>
<h4 id="req-ips"><a href="#req-ips" class="headerlink" title="req.ips"></a>req.ips</h4><p>当<code>trust proxy</code>设置项被设置为启用值，这个属性包含了一组在<code>X-Forwarded-For</code>请求头中指定的IP地址。不然，其就包含一个空的数组。这个头部可以被客户端或者代理设置。<br>例如，如果<code>X-Forwarded-For</code>是<code>client</code>，<code>proxy1</code>，<code>proxy2</code>，<code>req.ips</code>就是<code>[&quot;clinet&quot;, &quot;proxy1&quot;, &quot;proxy2&quot;]</code>，这里<code>proxy2</code>就是最远的下游。</p>
<h4 id="req-originalUrl"><a href="#req-originalUrl" class="headerlink" title="req.originalUrl"></a>req.originalUrl</h4><blockquote>
<p><code>req.url</code>不是一个原生的<code>Express</code>属性，它继承自<a target="_blank" rel="noopener" href="https://nodejs.org/api/http.html#http_message_url">Node’s http module</a>。</p>
</blockquote>
<p>这个属性很像<code>req.url</code>；然而，其保留了原版的请求链接，允许你自由地重定向<code>req.url</code>到内部路由。比如，<code>app.use()</code>的<code>mounting</code>特点可以重定向<code>req.url</code>跳转到挂载点。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// GET /search?q=something</span></span><br><span class="line">req.originalUrl</span><br><span class="line"><span class="comment">// =&gt; &quot;/search?q=something&quot;</span></span><br></pre></td></tr></table></figure>

<h4 id="req-params"><a href="#req-params" class="headerlink" title="req.params"></a>req.params</h4><p>一个对象，其包含了一系列的属性，这些属性和在路由中命名的参数名是一一对应的。例如，如果你有<code>/user/:name</code>路由，<code>name</code>属性可作为<code>req.params.name</code>。这个对象默认值为<code>&#123;&#125;</code>。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// GET /user/tj</span></span><br><span class="line">req.params.name</span><br><span class="line"><span class="comment">// =&gt; &quot;tj&quot;</span></span><br></pre></td></tr></table></figure>
<p>当你使用正则表达式来定义路由规则，捕获组的组合一般使用<code>req.params[n]</code>，这里的<code>n</code>是第几个捕获租。这个规则被施加在无名通配符匹配，比如<code>/file/*</code>的路由：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// GET /file/javascripts/jquery.js</span></span><br><span class="line">req.params[<span class="number">0</span>]</span><br><span class="line"><span class="comment">// =&gt; &quot;javascripts/jquery.js&quot;</span></span><br></pre></td></tr></table></figure>
<h4 id="req-path"><a href="#req-path" class="headerlink" title="req.path"></a>req.path</h4><p>包含请求URL的部分路径。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// example.com/users?sort=desc</span></span><br><span class="line">req.path</span><br><span class="line"><span class="comment">// =&gt; &quot;/users&quot;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>当在一个中间件中被调用，挂载点不包含在<code>req.path</code>中。你可以查阅<a target="_blank" rel="noopener" href="http://expressjs.com/4x/api.html#app.use">app.use()</a>获得跟多的信息。</p>
</blockquote>
<h4 id="req-protocol"><a href="#req-protocol" class="headerlink" title="req.protocol"></a>req.protocol</h4><p>请求的协议，一般为<code>http</code>，当启用TLS加密，则为<code>https</code>。<br>当<code>trust proxy</code>设置一个启用的参数，如果存在<code>X-Forwarded-Proto</code>头部的话，其将被信赖和使用。这个头部可以被客户端或者代理设置。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">req.ptotocol</span><br><span class="line">&#x2F;&#x2F; &#x3D;&gt; &quot;http&quot;</span><br></pre></td></tr></table></figure>

<h4 id="req-query"><a href="#req-query" class="headerlink" title="req.query"></a>req.query</h4><p>一个对象，为每一个路由中的<code>query string</code>参数都分配一个属性。如果没有<code>query string</code>，它就是一个空对象，<code>&#123;&#125;</code>。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// GET /search?q=tobi+ferret</span></span><br><span class="line">req.query.q</span><br><span class="line"><span class="comment">// =&gt; &quot;tobi ferret&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// GET /shoes?order=desc&amp;shoe[color]=blue&amp;shoe[type]=converse</span></span><br><span class="line">req.query.order</span><br><span class="line"><span class="comment">// =&gt; &quot;desc&quot;</span></span><br><span class="line"></span><br><span class="line">req.query.shoe.color</span><br><span class="line"><span class="comment">// =&gt; &quot;blue&quot;</span></span><br><span class="line"></span><br><span class="line">req.query.shoe.type</span><br><span class="line"><span class="comment">// =&gt; &quot;converse&quot;</span></span><br></pre></td></tr></table></figure>

<h4 id="req-route"><a href="#req-route" class="headerlink" title="req.route"></a>req.route</h4><p>当前匹配的路由，其为一串字符。比如：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">app.get(<span class="string">&#x27;/user/:id?&#x27;</span>, <span class="function"><span class="keyword">function</span> <span class="title">userIdHandler</span>(<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(req.route);</span><br><span class="line">    res.send(<span class="string">&#x27;GET&#x27;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>前面片段的输出为:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&#123; <span class="attr">path</span>:<span class="string">&quot;/user/:id?&quot;</span></span><br><span class="line">    stack:</span><br><span class="line">    [</span><br><span class="line">        &#123; <span class="attr">handle</span>:[<span class="built_in">Function</span>:userIdHandler],</span><br><span class="line">          name:<span class="string">&quot;userIdHandler&quot;</span>,</span><br><span class="line">          params:<span class="literal">undefined</span>,</span><br><span class="line">          path:<span class="literal">undefined</span>,</span><br><span class="line">          keys:[],</span><br><span class="line">          regexp:<span class="regexp">/^\/?$/i</span>,</span><br><span class="line">          method:<span class="string">&#x27;get&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line">    methods:&#123;<span class="attr">get</span>:<span class="literal">true</span>&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="req-secure"><a href="#req-secure" class="headerlink" title="req.secure"></a>req.secure</h4><p>一个布尔值，如果建立的是TLS的连接，那么就为<code>true</code>。等价与：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#39;https&#39; &#x3D;&#x3D; req.protocol;</span><br></pre></td></tr></table></figure>

<h4 id="req-signedCookies"><a href="#req-signedCookies" class="headerlink" title="req.signedCookies"></a>req.signedCookies</h4><p>当使用<code>cookie-parser</code>中间件的时候，这个属性包含的是请求发过来的签名<code>cookies</code>，这个属性取得的是不含签名，可以直接使用的值。签名的<code>cookies</code>保存在不同的对象中来体现开发者的意图；不然，一个恶意攻击可以被施加在<code>req.cookie</code>值上(它是很容易被欺骗的)。记住，签名一个<code>cookie</code>不是把它藏起来或者加密；而是简单的防止篡改(因为签名使用的加密是私人的)。如果没有发送签名的<code>cookie</code>，那么这个属性默认为<code>&#123;&#125;</code>。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; Cookie： user&#x3D;tobi.CP7AWaXDfAKIRfH49dQzKJx7sKzzSoPq7&#x2F;AcBBRVwlI3</span><br><span class="line">req.signedCookies.user</span><br><span class="line">&#x2F;&#x2F; &#x3D;&gt; &quot;tobi&quot;</span><br></pre></td></tr></table></figure>
<p>为了获取更多的信息，问题或者关注，可以参阅<a target="_blank" rel="noopener" href="https://github.com/expressjs/cookie-parser">cookie-parser</a>。</p>
<h4 id="req-stale"><a href="#req-stale" class="headerlink" title="req.stale"></a>req.stale</h4><p>指示这个请求是否是<code>stale</code>(陈旧的)，它与<code>req.fresh</code>是相反的。更多信息，可以查看<a target="_blank" rel="noopener" href="http://expressjs.com/4x/api.html#req.fresh">req.fresh</a>。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">req.stale</span><br><span class="line">&#x2F;&#x2F; &#x3D;&gt; true</span><br></pre></td></tr></table></figure>

<h4 id="req-subdomains"><a href="#req-subdomains" class="headerlink" title="req.subdomains"></a>req.subdomains</h4><p>请求中域名的子域名数组。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; Host: &quot;tobi.ferrets.example.com&quot;</span><br><span class="line">req.subdomains</span><br><span class="line">&#x2F;&#x2F; &#x3D;&gt; [&quot;ferrets&quot;, &quot;tobi&quot;]</span><br></pre></td></tr></table></figure>

<h4 id="req-xhr"><a href="#req-xhr" class="headerlink" title="req.xhr"></a>req.xhr</h4><p>一个布尔值，如果<code>X-Requested-With</code>的值为<code>XMLHttpRequest</code>，那么其为<code>true</code>，其指示这个请求是被一个客服端库发送，比如<code>jQuery</code>。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">req.xhr</span><br><span class="line">&#x2F;&#x2F; &#x3D;&gt; true</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="Methods-2"><a href="#Methods-2" class="headerlink" title="Methods"></a>Methods</h3><h4 id="req-accepts-types"><a href="#req-accepts-types" class="headerlink" title="req.accepts(types)"></a>req.accepts(types)</h4><p>检查这个指定的内容类型是否被接受，基于请求的<code>Accept</code> HTTP头部。这个方法返回最佳匹配，如果没有一个匹配，那么其返回<code>undefined</code>(在这个case下，服务器端应该返回406和”Not Acceptable”)。<br><code>type</code>值可以是一个单的<code>MIME type</code>字符串(比如<code>application/json</code>)，一个扩展名比如<code>json</code>，一个逗号分隔的列表，或者一个数组。对于一个列表或者数组，这个方法返回最佳项(如果有的话)。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Accept: text/html</span></span><br><span class="line">req.accepts(<span class="string">&#x27;html&#x27;</span>);</span><br><span class="line"><span class="comment">// =&gt; &quot;html&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Accept: text/*, application/json</span></span><br><span class="line">req.accepts(<span class="string">&#x27;html&#x27;</span>);</span><br><span class="line"><span class="comment">// =&gt; &quot;html&quot;</span></span><br><span class="line"></span><br><span class="line">req.accepts(<span class="string">&#x27;text/html&#x27;</span>);</span><br><span class="line"><span class="comment">// =&gt; &quot;text/html&quot;</span></span><br><span class="line"></span><br><span class="line">req.accepts([<span class="string">&#x27;json&#x27;</span>, <span class="string">&#x27;text&#x27;</span>]);</span><br><span class="line"><span class="comment">// =&gt; &quot;json&quot;</span></span><br><span class="line"></span><br><span class="line">req.accepts(<span class="string">&#x27;application/json&#x27;</span>);</span><br><span class="line"><span class="comment">// =&gt; &quot;application/json&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Accept: text/*, application/json</span></span><br><span class="line">req.accepts(<span class="string">&#x27;image/png&#x27;</span>);</span><br><span class="line">req.accepts(<span class="string">&#x27;png&#x27;</span>);</span><br><span class="line"><span class="comment">// =&gt; undefined</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Accept: text/*;q=.5, application/json</span></span><br><span class="line">req.accepts([<span class="string">&#x27;html&#x27;</span>, <span class="string">&#x27;json&#x27;</span>]);</span><br><span class="line"><span class="comment">// =&gt; &quot;json&quot;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>获取更多信息，或者如果你有问题或关注，可以参阅<a target="_blank" rel="noopener" href="https://github.com/expressjs/accepts">accepts</a>。</p>
<h4 id="req-acceptsCharsets-charset-…"><a href="#req-acceptsCharsets-charset-…" class="headerlink" title="req.acceptsCharsets(charset[, …])"></a>req.acceptsCharsets(charset[, …])</h4><p>返回指定的字符集集合中第一个的配置的字符集，基于请求的<code>Accept-Charset</code>HTTP头。如果指定的字符集没有匹配的，那么就返回false。<br>获取更多信息，或者如果你有问题或关注，可以参阅<a target="_blank" rel="noopener" href="https://github.com/expressjs/accepts">accepts</a>。</p>
<h4 id="req-acceptsEncodings-encoding-…"><a href="#req-acceptsEncodings-encoding-…" class="headerlink" title="req.acceptsEncodings(encoding[, …])"></a>req.acceptsEncodings(encoding[, …])</h4><p>返回指定的编码集合中第一个的配置的编码，基于请求的<code>Accept-Encoding</code>HTTP头。如果指定的编码集没有匹配的，那么就返回false。<br>获取更多信息，或者如果你有问题或关注，可以参阅<a target="_blank" rel="noopener" href="https://github.com/expressjs/accepts">accepts</a>。</p>
<h4 id="req-acceptsLanguages-lang-…"><a href="#req-acceptsLanguages-lang-…" class="headerlink" title="req.acceptsLanguages(lang [, …])"></a>req.acceptsLanguages(lang [, …])</h4><p>返回指定的语言集合中第一个的配置的语言，基于请求的<code>Accept-Language</code>HTTP头。如果指定的语言集没有匹配的，那么就返回false。<br>获取更多信息，或者如果你有问题或关注，可以参阅<a target="_blank" rel="noopener" href="https://github.com/expressjs/accepts">accepts</a>。</p>
<h4 id="req-get-field"><a href="#req-get-field" class="headerlink" title="req.get(field)"></a>req.get(field)</h4><p>返回指定的请求HTTP头部的域内容(不区分大小写)。<code>Referrer</code>和<code>Referer</code>的域内容可互换。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">req.get(<span class="string">&#x27;Content-type&#x27;</span>);</span><br><span class="line"><span class="comment">// =&gt; &quot;text/plain&quot;</span></span><br><span class="line"></span><br><span class="line">req.get(<span class="string">&#x27;content-type&#x27;</span>);</span><br><span class="line"><span class="comment">// =&gt; &quot;text/plain&quot;</span></span><br><span class="line"></span><br><span class="line">req.get(<span class="string">&#x27;Something&#x27;</span>)</span><br><span class="line"><span class="comment">// =&gt; undefined</span></span><br></pre></td></tr></table></figure>
<p>其是<code>req.header(field)</code>的别名。</p>
<h4 id="req-is-type"><a href="#req-is-type" class="headerlink" title="req.is(type)"></a>req.is(type)</h4><p>如果进来的请求的<code>Content-type</code>头部域匹配参数<code>type</code>给定的<code>MIME type</code>，那么其返回<code>true</code>。否则返回<code>false</code>。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// With Content-Type: text/html; charset=utf-8</span></span><br><span class="line">req.is(<span class="string">&#x27;html&#x27;</span>);</span><br><span class="line">req.is(<span class="string">&#x27;text/html&#x27;</span>);</span><br><span class="line">req.is(<span class="string">&#x27;text/*&#x27;</span>);</span><br><span class="line"><span class="comment">// =&gt; true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// When Content-Type is application/json</span></span><br><span class="line">req.is(<span class="string">&#x27;json&#x27;</span>);</span><br><span class="line">req.is(<span class="string">&#x27;application/json&#x27;</span>);</span><br><span class="line">req.is(<span class="string">&#x27;application/*&#x27;</span>);</span><br><span class="line"><span class="comment">// =&gt; true</span></span><br><span class="line"></span><br><span class="line">req.is(<span class="string">&#x27;html&#x27;</span>);</span><br><span class="line"><span class="comment">// =&gt; false</span></span><br></pre></td></tr></table></figure>
<p>获取更多信息，或者如果你有问题或关注，可以参阅<a target="_blank" rel="noopener" href="https://github.com/expressjs/type-is">type-is</a>。</p>
<h4 id="req-param-naem-defaultValue"><a href="#req-param-naem-defaultValue" class="headerlink" title="req.param(naem, [, defaultValue])"></a>req.param(naem, [, defaultValue])</h4><blockquote>
<p>过时的。可以在适合的情况下，使用<code>req.params</code>，<code>req.body</code>或者<code>req.query</code>。</p>
</blockquote>
<p>返回当前参数<code>name</code>的值。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; ?name&#x3D;tobi</span><br><span class="line">req.param(&#39;name&#39;)</span><br><span class="line">&#x2F;&#x2F; &#x3D;&gt; &quot;tobi&quot;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; POST name&#x3D;tobi</span><br><span class="line">req.param(&#39;name&#39;)</span><br><span class="line">&#x2F;&#x2F; &#x3D;&gt; &quot;tobi&quot;</span><br><span class="line">&#x2F;&#x2F; &#x2F;user&#x2F;tobi for &#x2F;user&#x2F;:name</span><br><span class="line">req.param(&#39;name&#39;)</span><br><span class="line">&#x2F;&#x2F; &#x3D;&gt; &quot;tobi&quot;</span><br></pre></td></tr></table></figure>
<p>按下面给出的顺序查找：</p>
<ul>
<li>req.params</li>
<li>req.body</li>
<li>req.query</li>
</ul>
<p>可选的，你可以指定一个<code>defaultValue</code>来设置一个默认值，如果这个参数在任何一个请求的对象中都不能找到。</p>
<blockquote>
<p>直接通过<code>req.params</code>，<code>req.body</code>，<code>req.query</code>取得应该更加的清晰-除非你确定每一个对象的输入。<br><code>Body-parser</code>中间件必须加载，如果你使用<code>req.param()</code>。详细请看<a target="_blank" rel="noopener" href="http://expressjs.com/4x/api.html#req.body">req.body</a>。</p>
</blockquote>
<h2 id="Response"><a href="#Response" class="headerlink" title="Response"></a>Response</h2><p><code>res</code>对象代表了当一个HTTP请求到来时，<code>Express</code>程序返回的HTTP响应。在本文档中，按照惯例，这个对象总是简称为<code>res</code>(http请求简称为<code>req</code>)，但是它们实际的名字由这个回调方法在那里使用时的参数决定。<br>例如：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">app.get(<span class="string">&#x27;/user/:id&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">    res.send(<span class="string">&#x27;user&#x27;</span> + req.params.id);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>这样写也是一样的：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">app.get(<span class="string">&#x27;/user/:id&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">request, response</span>) </span>&#123;</span><br><span class="line">    response.send(<span class="string">&#x27;user&#x27;</span> + request.params.id);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="Properties-2"><a href="#Properties-2" class="headerlink" title="Properties"></a>Properties</h3><h4 id="res-app"><a href="#res-app" class="headerlink" title="res.app"></a>res.app</h4><p>这个属性持有<code>express</code>程序实例的一个引用，其可以在中间件中使用。<br><code>res.app</code>和请求对象中的<code>req.app</code>属性是相同的。</p>
<h4 id="res-headersSent"><a href="#res-headersSent" class="headerlink" title="res.headersSent"></a>res.headersSent</h4><p>布尔类型的属性，指示这个响应是否已经发送HTTP头部。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">app.get(<span class="string">&#x27;/&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(res.headersSent); <span class="comment">// false</span></span><br><span class="line">    res.send(<span class="string">&#x27;OK&#x27;</span>); <span class="comment">// send之后就发送了头部</span></span><br><span class="line">    <span class="built_in">console</span>.log(res.headersSent); <span class="comment">// true</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h4 id="res-locals"><a href="#res-locals" class="headerlink" title="res.locals"></a>res.locals</h4><p>一个对象，其包含了本次请求的响应中的变量和因此它的变量只提供给本次请求响应的周期内视图渲染里使用(如果有视图的话)。<br>其他方面，其和<code>app.locals</code>是一样的。<br>这个参数在导出请求级别的信息是很有效的，这些信息比如请求路径，已认证的用户，用户设置等等。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">app.use(<span class="function"><span class="keyword">function</span>(<span class="params">req, res, next</span>) </span>&#123;</span><br><span class="line">    res.locals.user = req.user;</span><br><span class="line">    res.locals.authenticated = !req.user.anonymous;</span><br><span class="line">    next();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="Methods-3"><a href="#Methods-3" class="headerlink" title="Methods"></a>Methods</h3><h4 id="res-append-field-value"><a href="#res-append-field-value" class="headerlink" title="res.append(field [, value])"></a>res.append(field [, value])</h4><blockquote>
<p>res.append()方法在<code>Expresxs</code>4.11.0以上版本才支持。</p>
</blockquote>
<p>在指定的<code>field</code>的HTTP头部追加特殊的值<code>value</code>。如果这个头部没有被设置，那么将用<code>value</code>新建这个头部。<code>value</code>可以是一个字符串或者数组。<br>注意：在<code>res.append()</code>之后调用<code>app.set()</code>函数将重置前面设置的值。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">res.append(<span class="string">&#x27;Lind&#x27;</span>, [<span class="string">&#x27;&lt;http://localhost&gt;&#x27;</span>, <span class="string">&#x27;&lt;http://localhost:3000&gt;&#x27;</span>]);</span><br><span class="line">res.append(<span class="string">&#x27;Set-Cookie&#x27;</span>, <span class="string">&#x27;foo=bar;Path=/;HttpOnly&#x27;</span>);</span><br><span class="line">res.append(<span class="string">&#x27;Warning&#x27;</span>, <span class="string">&#x27;199 Miscellaneous warning&#x27;</span>);</span><br></pre></td></tr></table></figure>

<h4 id="res-attachment-filename"><a href="#res-attachment-filename" class="headerlink" title="res.attachment([filename])"></a>res.attachment([filename])</h4><p>设置HTTP响应的<code>Content-Disposition</code>头内容为”attachment”。如果提供了<code>filename</code>，那么将通过<code>res.type()</code>获得扩展名来设置<code>Content-Type</code>，并且设置<code>Content-Disposition</code>内容为”filename=”parameter。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">res.attachment();</span><br><span class="line">&#x2F;&#x2F; Content-Disposition: attachment</span><br><span class="line"></span><br><span class="line">res.attachment(&#39;path&#x2F;to&#x2F;logo.png&#39;);</span><br><span class="line">&#x2F;&#x2F; Content-Disposition: attachment; filename&#x3D;&quot;logo.png&quot;</span><br><span class="line">&#x2F;&#x2F; Content-Type: image&#x2F;png</span><br></pre></td></tr></table></figure>

<h4 id="res-cookie-name-value-options"><a href="#res-cookie-name-value-options" class="headerlink" title="res.cookie(name, value [,options])"></a>res.cookie(name, value [,options])</h4><p>设置<code>name</code>和<code>value</code>的<code>cookie</code>，<code>value</code>参数可以是一串字符或者是转化为json字符串的对象。<br>options是一个对象，其可以有下列的属性。</p>
<table>
<thead>
<tr>
<th align="center">属性</th>
<th align="center">类型</th>
<th align="center">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="center">domain</td>
<td align="center">String</td>
<td align="center">设置cookie的域名。默认是你本app的域名。</td>
</tr>
<tr>
<td align="center">expires</td>
<td align="center">Date</td>
<td align="center">cookie的过期时间，GMT格式。如果没有指定或者设置为0，则产生新的cookie。</td>
</tr>
<tr>
<td align="center">httpOnly</td>
<td align="center">Boolean</td>
<td align="center">这个cookie只能被web服务器获取的标示。</td>
</tr>
<tr>
<td align="center">maxAge</td>
<td align="center">String</td>
<td align="center">是设置过去时间的方便选项，其为过期时间到当前时间的毫秒值。</td>
</tr>
<tr>
<td align="center">path</td>
<td align="center">String</td>
<td align="center">cookie的路径。默认值是<code>/</code>。</td>
</tr>
<tr>
<td align="center">secure</td>
<td align="center">Boolean</td>
<td align="center">标示这个cookie只用被<code>HTTPS</code>协议使用。</td>
</tr>
<tr>
<td align="center">signed</td>
<td align="center">Boolean</td>
<td align="center">指示这个cookie应该是签名的。</td>
</tr>
</tbody></table>
<blockquote>
<p>res.cookie()所作的都是基于提供的<code>options</code>参数来设置<code>Set-Cookie</code>头部。没有指定任何的<code>options</code>，那么默认值在<code>RFC6265</code>中指定。</p>
</blockquote>
<p>使用实例：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">res.cookie(<span class="string">&#x27;name&#x27;</span>, <span class="string">&#x27;tobi&#x27;</span>, &#123;<span class="string">&#x27;domain&#x27;</span>:<span class="string">&#x27;.example.com&#x27;</span>, <span class="string">&#x27;path&#x27;</span>:<span class="string">&#x27;/admin&#x27;</span>, <span class="string">&#x27;secure&#x27;</span>:<span class="literal">true</span>&#125;);</span><br><span class="line">res.cookie(<span class="string">&#x27;remenberme&#x27;</span>, <span class="string">&#x27;1&#x27;</span>, &#123;<span class="string">&#x27;expires&#x27;</span>:<span class="keyword">new</span> <span class="built_in">Date</span>(<span class="built_in">Date</span>.now() + <span class="number">90000</span>), <span class="string">&#x27;httpOnly&#x27;</span>:<span class="literal">true</span>&#125;);</span><br></pre></td></tr></table></figure>
<p><code>maxAge</code>是一个方便设置过期时间的方便的选项，其以当前时间开始的毫秒数来计算。下面的示例和上面的第二条功效一样。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">res.cookie(<span class="string">&#x27;rememberme&#x27;</span>, <span class="string">&#x27;1&#x27;</span>, &#123;<span class="string">&#x27;maxAge&#x27;</span>:<span class="number">90000</span>&#125;, <span class="string">&quot;httpOnly&quot;</span>:<span class="literal">true</span>);</span><br></pre></td></tr></table></figure>
<p>你可以设置传递一个对象作为<code>value</code>的参数。然后其将被序列化为Json字符串，被<code>bodyParser()</code>中间件解析。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">res.cookie(<span class="string">&#x27;cart&#x27;</span>, &#123;<span class="string">&#x27;items&#x27;</span>:[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]&#125;);</span><br><span class="line">res.cookie(<span class="string">&#x27;cart&#x27;</span>, &#123;<span class="string">&#x27;items&#x27;</span>:[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]&#125;, &#123;<span class="string">&#x27;maxAge&#x27;</span>:<span class="number">90000</span>&#125;);</span><br></pre></td></tr></table></figure>
<p>当我们使用<code>cookie-parser</code>中间件的时候，这个方法也支持签名的cookie。简单地，在设置<code>options</code>时包含<code>signed</code>选项为<code>true</code>。然后<code>res.cookie()</code>将使用传递给<code>cookieParser(secret)</code>的密钥来签名这个值。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">res.cookie(&#39;name&#39;, &#39;tobi&#39;, &#123;&#39;signed&#39;:true&#125;);</span><br></pre></td></tr></table></figure>


<h4 id="res-clearCookie-name-options"><a href="#res-clearCookie-name-options" class="headerlink" title="res.clearCookie(name [,options])"></a>res.clearCookie(name [,options])</h4><p>根据指定的<code>name</code>清除对应的cookie。更多关于<code>options</code>对象可以查阅<code>res.cookie()</code>。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">res.cookie(<span class="string">&#x27;name&#x27;</span>, <span class="string">&#x27;tobi&#x27;</span>, &#123;<span class="string">&#x27;path&#x27;</span>:<span class="string">&#x27;/admin&#x27;</span>&#125;);</span><br><span class="line">res.clearCookie(<span class="string">&#x27;name&#x27;</span>, &#123;<span class="string">&#x27;path&#x27;</span>:<span class="string">&#x27;admin&#x27;</span>&#125;);</span><br></pre></td></tr></table></figure>
<h4 id="res-download-path-filename-fn"><a href="#res-download-path-filename-fn" class="headerlink" title="res.download(path, [,filename], [,fn])"></a>res.download(path, [,filename], [,fn])</h4><p>传输<code>path</code>指定文件作为一个附件。通常，浏览器提示用户下载。默认情况下，<code>Content-Disposition</code>头部”filename=”的参数为<code>path</code>(通常会出现在浏览器的对话框中)。通过指定<code>filename</code>参数来覆盖默认值。<br>当一个错误发生时或者传输完成，这个方法将调用<code>fn</code>指定的回调方法。这个方法使用<code>res.sendFile()</code>来传输文件。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">res.download(<span class="string">&#x27;/report-12345.pdf&#x27;</span>);</span><br><span class="line"></span><br><span class="line">res.download(<span class="string">&#x27;/report-12345.pdf&#x27;</span>, <span class="string">&#x27;report.pdf&#x27;</span>);</span><br><span class="line"></span><br><span class="line">res.download(<span class="string">&#x27;report-12345.pdf&#x27;</span>, <span class="string">&#x27;report.pdf&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">err</span>) </span>&#123;</span><br><span class="line"><span class="comment">// Handle error, but keep in mind the response may be partially-sent</span></span><br><span class="line"><span class="comment">// so check res.headersSent</span></span><br><span class="line"><span class="keyword">if</span> (err) &#123;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="comment">// decrement a download credit, etc.</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h4 id="res-end-data-encoding"><a href="#res-end-data-encoding" class="headerlink" title="res.end([data] [, encoding])"></a>res.end([data] [, encoding])</h4><p>结束本响应的过程。这个方法实际上来自<code>Node</code>核心模块，具体的是<a target="_blank" rel="noopener" href="https://nodejs.org/api/http.html#http_response_end_data_encoding_callback">response.end() method of http.ServerResponse</a>。<br>用来快速结束请求，没有任何的数据。如果你需要发送数据，可以使用<a target="_blank" rel="noopener" href="http://expressjs.com/4x/api.html#res.send">res.send()</a>和<a target="_blank" rel="noopener" href="http://expressjs.com/4x/api.html#res.json">res.json()</a>这类的方法。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">res.end();</span><br><span class="line">res.status(404).end();</span><br></pre></td></tr></table></figure>
<h4 id="res-format-object"><a href="#res-format-object" class="headerlink" title="res.format(object)"></a>res.format(object)</h4><p>进行内容协商，根据请求的对象中<code>Accept</code>HTTP头部指定的接受内容。它使用<a target="_blank" rel="noopener" href="http://expressjs.com/4x/api.html#res.accepts">req.accepts()</a>来选择一个句柄来为请求服务，这些句柄按质量值进行排序。如果这个头部没有指定，那么第一个方法默认被调用。当不匹配时，服务器将返回<code>406</code>“Not Acceptable”，或者调用<code>default</code>回调。<br><code>Content-Type</code>请求头被设置，当一个回调方法被选择。然而你可以改变他，在这个方法中使用这些方法，比如<code>res.set()</code>或者<code>res.type()</code>。<br>下面的例子，将回复<code>&#123;&quot;message&quot;:&quot;hey&quot;&#125;</code>，当请求的对象中<code>Accept</code>头部设置成”application/json”或者”*/json”(不过如果是<code>*/*</code>，然后这个回复就是”hey”)。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">res.format(&#123;</span><br><span class="line">    <span class="string">&#x27;text/plain&#x27;</span>:<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        res.send(<span class="string">&#x27;hey&#x27;</span>);</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">&#x27;text/html&#x27;</span>:<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        res.send(<span class="string">&#x27;&lt;p&gt;hey&lt;/p&gt;&#x27;</span>);</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">&#x27;application/json&#x27;</span>:<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        res.send(&#123;<span class="attr">message</span>:<span class="string">&#x27;hey&#x27;</span>&#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">&#x27;default&#x27;</span>:<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        res.status(<span class="number">406</span>).send(<span class="string">&#x27;Not Acceptable&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>除了规范化的MIME类型之外，你也可以使用拓展名来映射这些类型来避免冗长的实现：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">res.format(&#123;</span><br><span class="line">    text:<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        res.send(<span class="string">&#x27;hey&#x27;</span>);</span><br><span class="line">    &#125;,</span><br><span class="line">    html:<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        res.send(<span class="string">&#x27;&lt;p&gt;hey&lt;/p&gt;&#x27;</span>);</span><br><span class="line">    &#125;,</span><br><span class="line">    json:<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        res.send(&#123;<span class="attr">message</span>:<span class="string">&#x27;hey&#x27;</span>&#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h4 id="res-get-field"><a href="#res-get-field" class="headerlink" title="res.get(field)"></a>res.get(field)</h4><p>返回<code>field</code>指定的HTTP响应的头部。匹配是区分大小写。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">res.get(<span class="string">&#x27;Content-Type&#x27;</span>);</span><br><span class="line"><span class="comment">// =&gt; &quot;text/plain&quot;</span></span><br></pre></td></tr></table></figure>
<h4 id="res-json-body"><a href="#res-json-body" class="headerlink" title="res.json([body])"></a>res.json([body])</h4><p>发送一个json的响应。这个方法和将一个对象或者一个数组作为参数传递给<code>res.send()</code>方法的效果相同。不过，你可以使用这个方法来转换其他的值到json，例如<code>null</code>，<code>undefined</code>。(虽然这些都是技术上无效的JSON)。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">res.json(<span class="literal">null</span>);</span><br><span class="line">res.json(&#123;<span class="attr">user</span>:<span class="string">&#x27;tobi&#x27;</span>&#125;);</span><br><span class="line">res.status(<span class="number">500</span>).json(&#123;<span class="attr">error</span>:<span class="string">&#x27;message&#x27;</span>&#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="res-jsonp-body"><a href="#res-jsonp-body" class="headerlink" title="res.jsonp([body])"></a>res.jsonp([body])</h4><p>发送一个json的响应，并且支持JSONP。这个方法和<code>res.json()</code>效果相同，除了其在选项中支持JSONP回调。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">res.jsonp(null)</span><br><span class="line">&#x2F;&#x2F; &#x3D;&gt; null</span><br><span class="line"></span><br><span class="line">res.jsonp(&#123;user:&#39;tobi&#39;&#125;)</span><br><span class="line">&#x2F;&#x2F; &#x3D;&gt; &#123;&quot;user&quot; : &quot;tobi&quot;&#125;</span><br><span class="line"></span><br><span class="line">res.status(500).jsonp(&#123;error:&#39;message&#39;&#125;)</span><br><span class="line"> &#x2F;&#x2F; &#x3D;&gt; &#123;&quot;error&quot; : &quot;message&quot;&#125;</span><br></pre></td></tr></table></figure>
<p>默认情况下，jsonp的回调方法简单写作<code>callback</code>。可以通过<a target="_blank" rel="noopener" href="http://expressjs.com/4x/api.html#app.settings.table">jsonp callback name</a>设置来重写它。<br>下面是一些例子使用JSONP响应，使用相同的代码:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; ?callback&#x3D;foo</span><br><span class="line">res.jsonp(&#123;user:&#39;tobo&#39;&#125;)</span><br><span class="line">&#x2F;&#x2F; &#x3D;&gt; foo(&#123;&quot;user&quot;:&quot;tobi&quot;&#125;)</span><br><span class="line"></span><br><span class="line">app.set(&#39;jsonp callback name&#39;, &#39;cb&#39;)</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; ?cb&#x3D;foo</span><br><span class="line">res.status(500).jsonp(&#123;error:&#39;message&#39;&#125;)</span><br><span class="line">&#x2F;&#x2F; &#x3D;&gt; foo(&#123;&quot;error&quot;:&quot;message&quot;&#125;)</span><br></pre></td></tr></table></figure>
<h4 id="res-links-links"><a href="#res-links-links" class="headerlink" title="res.links(links)"></a>res.links(links)</h4><p>连接这些<code>links</code>，<code>links</code>是以传入参数的属性形式提供，连接之后的内容用来填充响应的Link HTTP头部。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">res.links(&#123;</span><br><span class="line">    next:&#39;http:&#x2F;&#x2F;api.example.com&#x2F;users?page&#x3D;2&#39;,</span><br><span class="line">    last:&#39;http:&#x2F;&#x2F;api.example.com&#x2F;user?page&#x3D;5&#39;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>效果：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Link:&lt;http:&#x2F;&#x2F;api.example.com&#x2F;users?page&#x3D;2&gt;;rel&#x3D;&quot;next&quot;,</span><br><span class="line">&lt;http:&#x2F;&#x2F;api.example.com&#x2F;users?page&#x3D;5&gt;;rel&#x3D;&quot;last&quot;</span><br></pre></td></tr></table></figure>

<h4 id="res-location-path"><a href="#res-location-path" class="headerlink" title="res.location(path)"></a>res.location(path)</h4><p>设置响应的<code>Location</code>HTTP头部为指定的<code>path</code>参数。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">res.location(<span class="string">&#x27;/foo/bar&#x27;</span>);</span><br><span class="line">res.location(<span class="string">&#x27;http://example.com&#x27;</span>);</span><br><span class="line">res.location(<span class="string">&#x27;back&#x27;</span>);</span><br></pre></td></tr></table></figure>
<p>当<code>path</code>参数为<code>back</code>时，其具有特殊的意义，其指定URL为请求对象的<code>Referer</code>头部指定的URL。如果请求中没有指定，那么其即为”/“。</p>
<blockquote>
<p>Express传递指定的URL字符串作为回复给浏览器响应中的<code>Location</code>头部的值，不检测和操作，除了<code>back</code>这个参数。浏览器会将用户重定向到<code>location</code>设置的url或者<code>Referer</code>的url（<code>back</code>参数的情况）</p>
</blockquote>
<h4 id="res-redirect-status-path"><a href="#res-redirect-status-path" class="headerlink" title="res.redirect([status,] path)"></a>res.redirect([status,] path)</h4><p>重定向来源于指定<code>path</code>的URL，以及指定的<a target="_blank" rel="noopener" href="http://www.w3.org/Protocols/rfc2616/rfc2616-sec10.html">HTTP status code</a><code>status</code>。如果你没有指定<code>status</code>，status code默认为”302 Found”。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">res.redirect(<span class="string">&#x27;/foo/bar&#x27;</span>);</span><br><span class="line">res.redirect(<span class="string">&#x27;http://example.com&#x27;</span>);</span><br><span class="line">res.redirect(<span class="number">301</span>, <span class="string">&#x27;http://example.com&#x27;</span>);</span><br><span class="line">res.redirect(<span class="string">&#x27;../login&#x27;</span>);</span><br></pre></td></tr></table></figure>
<p>重定向也可以是完整的URL，来重定向到不同的站点。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">res.redirect(&#39;http:&#x2F;&#x2F;google.com&#39;);</span><br></pre></td></tr></table></figure>
<p>重定向也可以相对于主机的根路径。比如，如果程序的路径为<code>http://example.com/admin/post/new</code>，那么下面将重定向到<code>http://example.com/admim</code>:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">res.redirect(&#39;&#x2F;admin&#39;);</span><br></pre></td></tr></table></figure>
<p>重定向也可以相对于当前的URL。比如，来之于<code>http://example.com/blog/admin/</code>(注意结尾的<code>/</code>)，下面将重定向到<code>http://example.com/blog/admin/post/new</code>。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">res.redirect(&#39;post&#x2F;new&#39;);</span><br></pre></td></tr></table></figure>
<p>如果来至于<code>http://example.com/blog/admin</code>（没有尾部<code>/</code>），重定向<code>post/new</code>，将重定向到<code>http://example.com/blog/post/new</code>。如果你觉得上面很混乱，可以把路径段认为目录(有’/‘)或者文件，这样是可以的。相对路径的重定向也是可以的。如果你当前的路径为<code>http://example.com/admin/post/new</code>，下面的操作将重定向到<code>http://example.com/admin/post</code>：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">res.redirect(&#39;..&#39;);</span><br></pre></td></tr></table></figure>
<p><code>back</code>将重定向请求到<a target="_blank" rel="noopener" href="http://en.wikipedia.org/wiki/HTTP_referer">referer</a>，当没有<code>referer</code>的时候，默认为<code>/</code>。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">res.redirect(&#39;back&#39;);</span><br></pre></td></tr></table></figure>

<h4 id="res-render-view-locals-callback"><a href="#res-render-view-locals-callback" class="headerlink" title="res.render(view [, locals] [, callback])"></a>res.render(view [, locals] [, callback])</h4><p>渲染一个视图，然后将渲染得到的HTML文档发送给客户端。可选的参数为:</p>
<ul>
<li><code>locals</code>，定义了视图本地参数属性的一个对象。</li>
<li><code>callback</code>，一个回调方法。如果提供了这个参数，<code>render</code>方法将返回错误和渲染之后的模板，并且不自动发送响应。当有错误发生时，可以在这个回调内部，调用<code>next(err)</code>方法。</li>
</ul>
<blockquote>
<p>本地变量缓存使能视图缓存。在开发环境中缓存视图，需要手动设置为true；视图缓存在生产环境中默认开启。</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&#x2F;&#x2F; send the rendered view to the client</span><br><span class="line">res.render(&#39;index&#39;);</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; if a callback is specified, the render HTML string has to be sent explicitly</span><br><span class="line"></span><br><span class="line">res.render(&#39;index&#39;, function(err, html) &#123;</span><br><span class="line">    res.send(html);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; pass a local variable to  the view</span><br><span class="line">res.render(&#39;user&#39;, &#123;name:&#39;Tobi&#39;&#125;, function(err, html) &#123;</span><br><span class="line">    &#x2F;&#x2F; ...</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>


<h4 id="res-send-body"><a href="#res-send-body" class="headerlink" title="res.send([body])"></a>res.send([body])</h4><p>发送HTTP响应。<br><code>body</code>参数可以是一个<code>Buffer</code>对象，一个字符串，一个对象，或者一个数组。比如：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">res.send(<span class="keyword">new</span> Buffer(<span class="string">&#x27;whoop&#x27;</span>));</span><br><span class="line">res.send(&#123;<span class="attr">some</span>:<span class="string">&#x27;json&#x27;</span>&#125;);</span><br><span class="line">res.send(<span class="string">&#x27;&lt;p&gt;some html&lt;/p&gt;&#x27;</span>);</span><br><span class="line">res.status(<span class="number">404</span>).send(<span class="string">&#x27;Sorry, we cannot find that!&#x27;</span>);</span><br><span class="line">res.status(<span class="number">500</span>).send(&#123; <span class="attr">error</span>: <span class="string">&#x27;something blew up&#x27;</span> &#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>对于一般的非流请求，这个方法可以执行许多有用的的任务：比如，它自动给<code>Content-Length</code>HTTP响应头赋值(除非先前定义)，也支持自动的HEAD和HTTP缓存更新。<br>当参数是一个<code>Buffer</code>对象，这个方法设置<code>Content-Type</code>响应头为<code>application/octet-stream</code>，除非事先提供，如下所示:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">res.set(&#39;Content-Type&#39;, &#39;text&#x2F;html&#39;);</span><br><span class="line">res.send(new Buffer(&#39;&lt;p&gt;some html&lt;&#x2F;p&gt;&#39;));</span><br></pre></td></tr></table></figure>
<p>当参数是一个字符串，这个方法设置<code>Content-Type</code>响应头为<code>text/html</code>：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">res.send(&#39;&lt;p&gt;some html&lt;&#x2F;p&gt;&#39;);</span><br></pre></td></tr></table></figure>

<p>当参数是一个对象或者数组，Express使用JSON格式来表示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">res.send(&#123;user:&#39;tobi&#39;&#125;);</span><br><span class="line">res.send([1, 2, 3]);</span><br></pre></td></tr></table></figure>

<h4 id="res-sendFile-path-options-fn"><a href="#res-sendFile-path-options-fn" class="headerlink" title="res.sendFile(path [, options] [, fn])"></a>res.sendFile(path [, options] [, fn])</h4><blockquote>
<p><code>res.sendFile()</code>从<code>Express v4.8.0</code>开始支持。</p>
</blockquote>
<p>传输<code>path</code>指定的文件。根据文件的扩展名设置<code>Content-Type</code>HTTP头部。除非在<code>options</code>中有关于<code>root</code>的设置，<code>path</code>一定是关于文件的绝对路径。<br>下面的表提供了<code>options</code>参数的细节:</p>
<table>
<thead>
<tr>
<th align="center">属性</th>
<th align="center">描述</th>
<th align="center">默认值</th>
<th align="center">可用版本</th>
</tr>
</thead>
<tbody><tr>
<td align="center">maxAge</td>
<td align="center">设置<code>Cache-Control</code>的<code>max-age</code>属性，格式为毫秒数，或者是<a target="_blank" rel="noopener" href="https://www.npmjs.org/package/ms">ms format</a>的一串字符串</td>
<td align="center">0</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">root</td>
<td align="center">相对文件名的根目录</td>
<td align="center"></td>
<td align="center"></td>
</tr>
<tr>
<td align="center">lastModified</td>
<td align="center">设置<code>Last-Modified</code>头部为此文件在系统中的最后一次修改时间。设置<code>false</code>来禁用它</td>
<td align="center">Enable</td>
<td align="center">4.9.0+</td>
</tr>
<tr>
<td align="center">headers</td>
<td align="center">一个对象，包含了文件相关的HTTP头部。</td>
<td align="center"></td>
<td align="center"></td>
</tr>
<tr>
<td align="center">dotfiles</td>
<td align="center">是否支持点开头文件名的选项。可选的值”allow”,”deny”,”ignore”</td>
<td align="center">“ignore”</td>
<td align="center">&nbsp;</td>
</tr>
<tr>
<td align="center">当传输完成或者发生了什么错误，这个方法调用<code>fn</code>回调方法。如果这个回调参数指定了和一个错误发生，回调方法必须明确地通过结束请求-响应循环或者传递控制到下个路由来处理响应过程。</td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
</tr>
<tr>
<td align="center">下面是使用了所有参数的使用<code>res.sendFile()</code>的例子：</td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
</tr>
</tbody></table>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">app.get(<span class="string">&#x27;/file/:name&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">req, res, next</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> options = &#123;</span><br><span class="line">        root:__dirname + <span class="string">&#x27;/public&#x27;</span>,</span><br><span class="line">        dotfile:<span class="string">&#x27;deny&#x27;</span>,</span><br><span class="line">        headers:&#123;</span><br><span class="line">            <span class="string">&#x27;x-timestamp&#x27;</span>:<span class="built_in">Date</span>.now(),</span><br><span class="line">            <span class="string">&#x27;x-sent&#x27;</span>:<span class="literal">true</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> fileName = req.params.name;</span><br><span class="line">    res.sendFile(fileName, options, <span class="function"><span class="keyword">function</span>(<span class="params">err</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (err) &#123;</span><br><span class="line">            <span class="built_in">console</span>.log(err);</span><br><span class="line">            res.status(err.status).end();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&#x27;sent&#x27;</span>, fileName);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><code>res.sendFile</code>提供了文件服务的细粒度支持，如下例子说明：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">app.get(<span class="string">&#x27;/user/:uid/photos/:file&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> uid = req.params.uid</span><br><span class="line">        , file = req.params.file;</span><br><span class="line">        </span><br><span class="line">    </span><br><span class="line">    req.user.mayViewFilesFrom(uid, <span class="function"><span class="keyword">function</span>(<span class="params">yes</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (yes) &#123;</span><br><span class="line">            res.sendFile(<span class="string">&#x27;/upload/&#x27;</span> + uid + <span class="string">&#x27;/&#x27;</span> + file);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            res.status(<span class="number">403</span>).send(<span class="string">&#x27;Sorry! you cant see that.&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>获取更多信息，或者你有问题或者关注，可以查阅<a target="_blank" rel="noopener" href="https://github.com/pillarjs/send">send</a>。</p>
<h4 id="res-sendStatus-statusCode"><a href="#res-sendStatus-statusCode" class="headerlink" title="res.sendStatus(statusCode)"></a>res.sendStatus(statusCode)</h4><p>设置响应对象的<code>HTTP status code</code>为<code>statusCode</code>并且发送<code>statusCode</code>的相应的字符串形式作为响应的Body。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">res.sendStatus(<span class="number">200</span>); <span class="comment">// equivalent to res.status(200).send(&#x27;OK&#x27;);</span></span><br><span class="line">res.sendStatus(<span class="number">403</span>); <span class="comment">// equivalent to res.status(403).send(&#x27;Forbidden&#x27;);</span></span><br><span class="line">res.sendStatus(<span class="number">404</span>); <span class="comment">// equivalent to res.status(404).send(&#x27;Not Found&#x27;);</span></span><br><span class="line">res.sendStatus(<span class="number">500</span>); <span class="comment">// equivalent to res.status(500).send(&#x27;Internal Server Error&#x27;)</span></span><br></pre></td></tr></table></figure>
<p>如果一个不支持的状态被指定，这个HTTP status依然被设置为<code>statusCode</code>并且用这个code的字符串作为Body。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">res.sendStatus(2000); &#x2F;&#x2F; equivalent to res.status(2000).send(&#39;2000&#39;);</span><br></pre></td></tr></table></figure>
<p><a target="_blank" rel="noopener" href="http://en.wikipedia.org/wiki/List_of_HTTP_status_codes">More about HTTP Status Codes</a></p>
<h4 id="res-set-field-value"><a href="#res-set-field-value" class="headerlink" title="res.set(field [, value])"></a>res.set(field [, value])</h4><p>设置响应对象的HTTP头部<code>field</code>为<code>value</code>。为了一次设置多个值，那么可以传递一个对象为参数。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">res.set(&#39;Content-Type&#39;, &#39;text&#x2F;plain&#39;);</span><br><span class="line"></span><br><span class="line">res.set(&#123;</span><br><span class="line">    &#39;Content-Type&#39;:&#39;text&#x2F;plain&#39;,</span><br><span class="line">    &#39;Content-Length&#39;:&#39;123&#39;,</span><br><span class="line">    &#39;ETag&#39;:&#39;123456&#39;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>其和<code>res.header(field [,value])</code>效果一致。</p>
<h4 id="res-status-code"><a href="#res-status-code" class="headerlink" title="res.status(code)"></a>res.status(code)</h4><p>使用这个方法来设置响应对象的HTTP status。其是Node中<a target="_blank" rel="noopener" href="http://nodejs.org/api/http.html#http_response_statuscode">response.statusCode</a>的一个连贯性的别名。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">res.status(403).end();</span><br><span class="line">res.status(400).send(&#39;Bad Request&#39;);</span><br><span class="line">res.status(404).sendFile(&#39;&#x2F;absolute&#x2F;path&#x2F;to&#x2F;404.png&#39;);</span><br></pre></td></tr></table></figure>

<h4 id="res-type-type"><a href="#res-type-type" class="headerlink" title="res.type(type)"></a>res.type(type)</h4><p>程序将设置<code>Content-Type</code>HTTP头部的MIME type，如果这个设置的<code>type</code>能够被<a target="_blank" rel="noopener" href="https://github.com/broofa/node-mime">mime.lookup</a>解析成正确的<code>Content-Type</code>。如果<code>type</code>中包含了<code>/</code>字符，那么程序会直接设置<code>Content-Type</code>为<code>type</code>。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">res.type(<span class="string">&#x27;.html&#x27;</span>);              <span class="comment">// =&gt; &#x27;text/html&#x27;</span></span><br><span class="line">res.type(<span class="string">&#x27;html&#x27;</span>);               <span class="comment">// =&gt; &#x27;text/html&#x27;</span></span><br><span class="line">res.type(<span class="string">&#x27;json&#x27;</span>);               <span class="comment">// =&gt; &#x27;application/json&#x27;</span></span><br><span class="line">res.type(<span class="string">&#x27;application/json&#x27;</span>);   <span class="comment">// =&gt; &#x27;application/json&#x27;</span></span><br><span class="line">res.type(<span class="string">&#x27;png&#x27;</span>);                <span class="comment">// =&gt; image/png:</span></span><br></pre></td></tr></table></figure>


<h4 id="res-vary-field"><a href="#res-vary-field" class="headerlink" title="res.vary(field)"></a>res.vary(field)</h4><p>在没有Vary应答头部时增加Vary应答头部。</p>
<blockquote>
<p>ps：vary的意义在于告诉代理服务器/缓存/CDN，如何判断请求是否一样，vary中的组合就是服务器/缓存/CDN判断的依据，比如Vary中有User-Agent，那么即使相同的请求，如果用户使用IE打开了一个页面，再用Firefox打开这个页面的时候，CDN/代理会认为是不同的页面，如果Vary中没有User-Agent，那么CDN/代理会认为是相同的页面，直接给用户返回缓存的页面，而不会再去web服务器请求相应的页面。通俗的说就相当于<code>field</code>作为了一个缓存的key来判断是否命中缓存</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">res.vary(&#39;User-Agent&#39;).render(&#39;docs&#39;);</span><br></pre></td></tr></table></figure>

<h2 id="Router"><a href="#Router" class="headerlink" title="Router"></a>Router</h2><p>一个<code>router</code>对象是一个单独的实例关于中间件和路由。你可以认为其是一个”mini-application”（迷你程序），其具有操作中间件和路由方法的能力。每个<code>Express</code>程序有一个内建的app路由。<br>路由自身表现为一个中间件，所以你可以使用它作为<code>app.use()</code>方法的一个参数或者作为另一个路由的<code>use()</code>的参数。<br>顶层的<code>express</code>对象有一个<code>Router()</code>方法，你可以使用<code>Router()</code>来创建一个新的<code>router</code>对象。</p>
<h3 id="Router-options"><a href="#Router-options" class="headerlink" title="Router([options])"></a>Router([options])</h3><p>如下，可以创建一个路由：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">var router &#x3D; express.Router([options]);</span><br></pre></td></tr></table></figure>
<p><code>options</code>参数可以指定路由的行为，其有下列选择：</p>
<table>
<thead>
<tr>
<th align="center">属性</th>
<th align="center">描述</th>
<th align="center">默认值</th>
<th align="center">可用性</th>
</tr>
</thead>
<tbody><tr>
<td align="center">caseSensitive</td>
<td align="center">是否区分大小写</td>
<td align="center">默认不启用。对待<code>/Foo</code>和<code>/foo</code>一样。</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">mergeParams</td>
<td align="center">保存父路由的<code>res.params</code>。如果父路由参数和子路由参数冲突，子路由参数优先。</td>
<td align="center">false</td>
<td align="center">4.5.0+</td>
</tr>
<tr>
<td align="center">strict</td>
<td align="center">使能严格路由。</td>
<td align="center">默认不启用，<code>/foo</code>和<code>/foo/</code>被路由一样对待处理</td>
<td align="center">&nbsp;</td>
</tr>
</tbody></table>
<p>你可以将<code>router</code>当作一个程序，可以在其上添加中间件和HTTP路由方法(例如<code>get</code>，<code>put</code>，<code>post</code>等等)。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; invoked for any requests passed to this router</span><br><span class="line">router.use(function(req, res, next) &#123;</span><br><span class="line">  &#x2F;&#x2F; .. some logic here .. like any other middleware</span><br><span class="line">  next();</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; will handle any request that ends in &#x2F;events</span><br><span class="line">&#x2F;&#x2F; depends on where the router is &quot;use()&#39;d&quot;</span><br><span class="line">router.get(&#39;&#x2F;events&#39;, function(req, res, next) &#123;</span><br><span class="line">  &#x2F;&#x2F; ..</span><br><span class="line">&#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>你可以在一个特别的根URL上挂载一个路由，这样你就以将你的各个路由放到不同的文件中或者甚至是mini的程序。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; only requests to &#x2F;calendar&#x2F;* will be sent to our &quot;router&quot;</span><br><span class="line">app.use(&#39;&#x2F;calendar&#39;, router);</span><br></pre></td></tr></table></figure>

<h3 id="Methods-4"><a href="#Methods-4" class="headerlink" title="Methods"></a>Methods</h3><h4 id="router-all-path-callback-…-callback"><a href="#router-all-path-callback-…-callback" class="headerlink" title="router.all(path, [callback, …] callback)"></a>router.all(path, [callback, …] callback)</h4><p>这个方法和<code>router.METHOD()</code>方法一样，除了这个方法会匹配所有的HTTP动作。<br>这个方法对想映射全局的逻辑处理到特殊的路径前缀或者任意匹配是十分有用的。比如，如果你放置下面所示的这个路由在其他路由的前面，那么其将要求从这个点开始的所有的路由进行验证操作和自动加载用户信息。记住，这些全局的逻辑操作，不需要结束请求响应周期：<code>loaduser</code>可以执行一个任务，然后调用<code>next()</code>来将执行流程移交到随后的路由。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">router.all(&#39;*&#39;, requireAuthentication, loadUser);</span><br></pre></td></tr></table></figure>
<p>相等的形式:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">router.all(&#39;*&#39;, requireAuthentication)</span><br><span class="line">router.all(&#39;*&#39;, loadUser);</span><br></pre></td></tr></table></figure>
<p>这是一个白名单全局功能的例子。这个例子很像前面的，不过其仅仅作用于以<code>/api</code>开头的路径:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">router.all(&#39;&#x2F;api&#x2F;*&#39;, requireAuthentication);</span><br></pre></td></tr></table></figure>
<h4 id="router-METHOD-path-callback-…-callback"><a href="#router-METHOD-path-callback-…-callback" class="headerlink" title="router.METHOD(path, [callback, …] callback)"></a>router.METHOD(path, [callback, …] callback)</h4><p><code>router.METHOD()</code>方法提供了路由方法在<code>Express</code>中，这里的<code>METHOD</code>是HTTP方法中的一个，比如<code>GET</code>，<code>PUT</code>，<code>POST</code>等等，但<code>router</code>中的METHOD是小写的。所以，实际的方法是<code>router.get()</code>，<code>router.put()</code>，<code>router.post()</code>等等。<br>你可以提供多个回调函数，它们的行为和中间件一样，除了这些回调可以通过调用<code>next(&#39;router&#39;)</code>来绕过剩余的路由回调。你可以使用这个机制来为一个路由设置一些前提条件，如果请求没有满足当前路由的处理条件，那么传递控制到随后的路由。<br>下面的片段可能说明了最简单的路由定义。Experss转换path字符串为正则表达式，用于内部匹配传入的请求。在匹配的时候，是不考虑<code>Query strings</code>，例如，”GET /“将匹配下面的路由，”GET /?name=tobi”也是一样的。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">router.get(&#39;&#x2F;&#39;, function(req, res) &#123;</span><br><span class="line">    res.send(&#39;Hello World&#39;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>如果你对匹配的path有特殊的限制，你可以使用正则表达式，例如，下面的可以匹配”GET /commits/71dbb9c”和”GET /commits/71bb92..4c084f9”。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">router.get(<span class="regexp">/^\/commits\/(\w+)(?:\.\.(\w+))?$/</span>, <span class="function"><span class="keyword">function</span>(<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> <span class="keyword">from</span> = req.params[<span class="number">0</span>];</span><br><span class="line">    <span class="keyword">var</span> to = req.params[<span class="number">1</span>];</span><br><span class="line">    res.send(<span class="string">&#x27;commit range &#x27;</span> + <span class="keyword">from</span> + <span class="string">&#x27;..&#x27;</span> + to);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h4 id="router-param-name-callback"><a href="#router-param-name-callback" class="headerlink" title="router.param(name, callback)"></a>router.param(name, callback)</h4><p>给路由参数添加回调触发器，这里的<code>name</code>是参数名，<code>function</code>是回调方法。回调方法的参数按序是请求对象，响应对象，下个中间件，参数值和参数名。虽然<code>name</code>在技术上是可选的，但是自Express V4.11.0之后版本不推荐使用(见下面)。</p>
<blockquote>
<p>不像<code>app.param()</code>，<code>router.param()</code>不接受一个数组作为路由参数。</p>
</blockquote>
<p>例如，当<code>:user</code>出现在路由路径中，你可以映射用户加载的逻辑处理来自动提供<code>req.user</code>给这个路由，或者对输入的参数进行验证。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">router.param(<span class="string">&#x27;user&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">req, res, next, id</span>) </span>&#123;</span><br><span class="line">    User.find(id, <span class="function"><span class="keyword">function</span>(<span class="params">error, user</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (err) &#123;</span><br><span class="line">            next(err);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (user)&#123;</span><br><span class="line">            req.user = user;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            next(<span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&#x27;failed to load user&#x27;</span>));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>对于<code>Param</code>的回调定义的路由来说，他们是局部的。它们不会被挂载的app或者路由继承。所以，定义在<code>router</code>上的<code>param</code>回调只有是在<code>router</code>上的路由具有这个路由参数时才起作用。<br>在定义<code>param</code>的路由上，<code>param</code>回调都是第一个被调用的，它们在一个请求-响应循环中都会被调用一次并且只有一次，即使多个路由都匹配，如下面的例子：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">router.param(<span class="string">&#x27;id&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">req, res, next, id</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;CALLED ONLY ONCE&#x27;</span>);</span><br><span class="line">    next();</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">router.get(<span class="string">&#x27;/user/:id&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">req, res, next</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;although this matches&#x27;</span>);</span><br><span class="line">    next();</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">router.get(<span class="string">&#x27;/user/:id&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;and this mathces too&#x27;</span>);</span><br><span class="line">    res.end();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>当<code>GET /user/42</code>，得到下面的结果:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">CALLED ONLY ONCE</span><br><span class="line">although this matches</span><br><span class="line">and this matches too</span><br></pre></td></tr></table></figure>
<p>`</p>
<blockquote>
<p>下面章节描述的<code>router.param(callback)</code>在v4.11.0之后被弃用。</p>
</blockquote>
<p>通过只传递一个回调参数给<code>router.param(name, callback)</code>方法，<code>router.param(naem, callback)</code>方法的行为将被完全改变。这个回调参数是关于<code>router.param(name, callback)</code>该具有怎样的行为的一个自定义方法，这个方法必须接受两个参数并且返回一个中间件。<br>这个回调的第一个参数就是需要捕获的url的参数名，第二个参数可以是任一的JavaScript对象，其可能在实现返回一个中间件时被使用。<br>这个回调方法返回的中间件决定了当URL中包含这个参数时所采取的行为。<br>在下面的例子中，<code>router.param(name, callback)</code>参数签名被修改成了<code>router.param(name, accessId)</code>。替换接受一个参数名和回调，<code>router.param()</code>现在接受一个参数名和一个数字。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> app = express();</span><br><span class="line"><span class="keyword">var</span> router = express.Router();</span><br><span class="line"></span><br><span class="line">router.param(<span class="function"><span class="keyword">function</span>(<span class="params">param, option</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params">req, res, next, val</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (val == option) &#123;</span><br><span class="line">            next();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            res.sendStatus(<span class="number">403</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">router.param(<span class="string">&#x27;id&#x27;</span>, <span class="number">1337</span>);</span><br><span class="line"></span><br><span class="line">router.get(<span class="string">&#x27;/user/:id&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">    res.send(<span class="string">&#x27;Ok&#x27;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.use(router);</span><br><span class="line"></span><br><span class="line">app.listen(<span class="number">3000</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;Ready&#x27;</span>);</span><br><span class="line">&#125;); </span><br></pre></td></tr></table></figure>
<p>在这个例子中，<code>router.param(name. callback)</code>参数签名保持和原来一样，但是替换成了一个中间件，定义了一个自定义的数据类型检测方法来检测<code>user id</code>的类型正确性。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">router.param(<span class="function"><span class="keyword">function</span>(<span class="params">param, validator</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params">req, res, next, val</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (validator(val)) &#123;</span><br><span class="line">            next();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            res.sendStatus(<span class="number">403</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">router.param(<span class="string">&#x27;id&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">candidate</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> !<span class="built_in">isNaN</span>(<span class="built_in">parseFloat</span>(candidate)) &amp;&amp; <span class="built_in">isFinite</span>(candidate);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h4 id="router-route-path"><a href="#router-route-path" class="headerlink" title="router.route(path)"></a>router.route(path)</h4><p>返回一个单例模式的路由的实例，之后你可以在其上施加各种HTTP动作的中间件。使用<code>router.route()</code>来避免重复路由名字(例如错字错误)–说的意思应该是使用<code>router.route()</code>这个单例方法来避免同一个路径多个路由实例。</p>
<p>构建在上面的<code>router.param()</code>例子之上，下面的代码展示了怎么使用<code>router.route()</code>来指定各种HTTP方法的处理句柄。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> router = express.Router();</span><br><span class="line"></span><br><span class="line">router.param(<span class="string">&#x27;user_id&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">req, res, next, id</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// sample user, would actually fetch from DB, etc...</span></span><br><span class="line">    req.user = &#123;</span><br><span class="line">        id:id,</span><br><span class="line">        name:<span class="string">&quot;TJ&quot;</span></span><br><span class="line">    &#125;;</span><br><span class="line">    next();</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">router.route(<span class="string">&#x27;/users/:user_id&#x27;</span>)</span><br><span class="line">    .all(<span class="function"><span class="keyword">function</span>(<span class="params">req, res, next</span>) </span>&#123;</span><br><span class="line">        <span class="comment">// runs for all HTTP verbs first</span></span><br><span class="line">        <span class="comment">// think of it as route specific middleware!</span></span><br><span class="line">        next();</span><br><span class="line">    &#125;)</span><br><span class="line">    .get(<span class="function"><span class="keyword">function</span>(<span class="params">req, res, next</span>) </span>&#123;</span><br><span class="line">        res.json(req.user);</span><br><span class="line">    &#125;)</span><br><span class="line">    .put(<span class="function"><span class="keyword">function</span>(<span class="params">req, res, next</span>) </span>&#123;</span><br><span class="line">        <span class="comment">// just an example of maybe updating the user</span></span><br><span class="line">        req.user.name = req.params.name;</span><br><span class="line">        <span class="comment">// save user ... etc</span></span><br><span class="line">        res.json(req.user);</span><br><span class="line">    &#125;)</span><br><span class="line">    .post(<span class="function"><span class="keyword">function</span>(<span class="params">req, res, next</span>) </span>&#123;</span><br><span class="line">        next(<span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&#x27;not implemented&#x27;</span>));</span><br><span class="line">    &#125;)</span><br><span class="line">    .delete(<span class="function"><span class="keyword">function</span>(<span class="params">req, res, next</span>) </span>&#123;</span><br><span class="line">        next(<span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&#x27;not implemented&#x27;</span>));</span><br><span class="line">    &#125;)</span><br></pre></td></tr></table></figure>
<p>这种方法重复使用单个<code>/usrs/:user_id</code>路径来添加了各种的HTTP方法。</p>
<h4 id="router-use-path-function-…-function"><a href="#router-use-path-function-…-function" class="headerlink" title="router.use([path], [function, …] function)"></a>router.use([path], [function, …] function)</h4><p>给可选的<code>path</code>参数指定的路径挂载给定的中间件方法，未指定<code>path</code>参数，默认值为<code>/</code>。<br>这个方法类似于<code>app.use()</code>。一个简单的例子和用例在下面描述。查阅<a target="_blank" rel="noopener" href="http://expressjs.com/en/4x/api.html#app.use">app.use()</a>获得更多的信息。<br>中间件就像一个水暖管道，请求在你定义的第一个中间件处开始，顺着中间件堆栈一路往下，如果路径匹配则处理这个请求。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> app = express();</span><br><span class="line"><span class="keyword">var</span> router = express.Router();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// simple logger for this router`s requests</span></span><br><span class="line"><span class="comment">// all requests to this router will first hit this middleware</span></span><br><span class="line"></span><br><span class="line">router.use(<span class="function"><span class="keyword">function</span>(<span class="params">req, res, next</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;%s %s %s&#x27;</span>, req.method, req.url, req.path);</span><br><span class="line">    next();</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// this will only be invoked if the path starts with /bar form the mount ponit</span></span><br><span class="line">router.use(<span class="string">&#x27;/bar&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">req, res, next</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// ... maybe some additional /bar logging ...</span></span><br><span class="line">    next();</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// always be invoked</span></span><br><span class="line">router.use(<span class="function"><span class="keyword">function</span>(<span class="params">req, res, next</span>) </span>&#123;</span><br><span class="line">    res.send(<span class="string">&#x27;hello world&#x27;</span>)；</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.use(<span class="string">&#x27;/foo&#x27;</span>, router);</span><br><span class="line"></span><br><span class="line">app.listen(<span class="number">3000</span>);</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>对于中间件<code>function</code>，挂载的路径是被剥离的和不可见的。关于这个特性主要的影响是对于不同的路径，挂载相同的中间件可能对代码不做改动，尽管其前缀已经改变。<br>你使用<code>router.use()</code>定义中间件的顺序很重要。中间们是按序被调用的，所以顺序决定了中间件的优先级。例如，通常日志是你将使用的第一个中间件，以便每一个请求都被记录。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> logger = <span class="built_in">require</span>(<span class="string">&#x27;morgan&#x27;</span>);</span><br><span class="line"></span><br><span class="line">router.use(logger());</span><br><span class="line">router.use(express.static(__dirname + <span class="string">&#x27;/public&#x27;</span>));</span><br><span class="line">router.use(<span class="function"><span class="keyword">function</span>(<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">    res.send(<span class="string">&#x27;Hello&#x27;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>现在为了支持你不希望记录静态文件请求，但为了继续记录那些定义在<code>logger()</code>之后的路由和中间件。你可以简单的将<code>static()</code>移动到前面来解决：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">router.use(express.static(__dirname + <span class="string">&#x27;/public&#x27;</span>));</span><br><span class="line">router.use(logger());</span><br><span class="line">router.use(<span class="function"><span class="keyword">function</span>(<span class="params">req, res</span>)</span>&#123;</span><br><span class="line">  res.send(<span class="string">&#x27;Hello&#x27;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>另外一个确凿的例子是从不同的路径托管静态文件，你可以将<code>./public</code>放到前面来获得更高的优先级:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">app.use(express.static(__dirname + <span class="string">&#x27;/public&#x27;</span>));</span><br><span class="line">app.use(express.static(__dirname + <span class="string">&#x27;/files&#x27;</span>));</span><br><span class="line">app.use(express.static(__dirname + <span class="string">&#x27;/uploads&#x27;</span>));</span><br></pre></td></tr></table></figure>
<p><code>router.use()</code>方法也支持命名参数，以便你的挂载点对于其他的路由而言，可以使用命名参数来进行预加载，这样做是很有益的。</p>
<h1 id="express-中常用中间件"><a href="#express-中常用中间件" class="headerlink" title="express 中常用中间件"></a>express 中常用中间件</h1><h2 id="解析请求体的中间件"><a href="#解析请求体的中间件" class="headerlink" title="解析请求体的中间件"></a>解析请求体的中间件</h2><p>这类中间件比较多，常见的有：<code>body-parser</code>、<code>multer</code>、<code>formidable</code>、<code>multiparty</code>、<code>busboy</code>,以及还有诸多不再推荐使用的。</p>
<p>而这种中间件经常用来处理一下这几种请求类型：</p>
<ol>
<li>application/x-www-form-urlencoded 常见的form提交</li>
<li>multipart/form-data 文件提交</li>
<li>application/json 提交json格式的数据</li>
<li>text/xml 提交xml格式的数据</li>
</ol>
<h3 id="body-parser中间件"><a href="#body-parser中间件" class="headerlink" title="body-parser中间件"></a>body-parser中间件</h3><p>这个中间件用于处理第1,3种<code>content-type</code> 的<code>body</code>非常的方便，但不能用于处理<code>multipart</code>类型的<code>body</code>，具体<code>api</code>可见<code>GitHub</code>，提供了四种方法</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">bodyParser.json() 将body解析为json</span><br><span class="line">bodyParser.text() 将body解析为文本</span><br><span class="line">bodyParser.raw() 将body解析为二进制</span><br><span class="line">bodyParser.urlencoded() 将编码为URLEncoder的body解析出来</span><br></pre></td></tr></table></figure>
<p>其中文文档翻译：<a target="_blank" rel="noopener" href="http://blog.csdn.net/liangklfang/article/details/51003120">翻译一</a>、<a target="_blank" rel="noopener" href="http://blog.csdn.net/z1233691/article/details/51526431">翻译二</a></p>
<h3 id="Multer-中间件"><a href="#Multer-中间件" class="headerlink" title="Multer 中间件"></a>Multer 中间件</h3><p>只处理类型是<code>multipart/form-data</code>的<code>body</code>。<br>它的主要功能是： <code>.single(&#39;photo&#39;) ``.array(&#39;photos&#39;, 12)`` .fields([])</code>分别对应处理上传文件，批量上传和分类上传，同时也带有处理纯文字的功能，用上面三个方法不带参数即可。<br>其<a target="_blank" rel="noopener" href="https://github.com/expressjs/multer/blob/master/doc/README-zh-cn.md">中文文档翻译</a></p>
<h3 id="Formidable-中间件"><a href="#Formidable-中间件" class="headerlink" title="Formidable 中间件"></a>Formidable 中间件</h3><p><code>Formidable</code>它的主页上的特性描述看起来很厉害的样子,在<code>express</code>中我们用<code>express-formidable</code>（<code>Formidable</code>中间件不仅能用于<code>express</code>更适合于<code>node</code>，所以有一个人就写了一个可以直接把<code>Formidable</code>用于<code>express</code>的中间件<code>express-formidable</code>，但是用的<code>API</code>与<code>Formidable</code>还基本相同） ，可用于处理表单和上传文件，功能大而全,可配置项非常多，最大的区别是还提供了一个对象,用于处理各种事件。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">var form &#x3D; new formidable.IncomingForm()</span><br><span class="line">form.on(&#39;fileBegin&#39;, function(name, file) &#123;</span><br><span class="line">&#125;);</span><br><span class="line">.on(&#39;file&#39;, function(name, file) &#123;</span><br><span class="line">&#125;);</span><br><span class="line">.on(&#39;error&#39;, function(err) &#123;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>在实际开发中，很明显可以用<code>bodyparser</code>和<code>multer</code>来分别处理表单和文件(express 官方推荐联合使用上述两个)，也可以只用<code>formidable</code>，按需取用即可。</p>
<p>本章节搜集于网络，原作者为<a target="_blank" rel="noopener" href="http://www.jianshu.com/p/828fdf02de06">le_1</a>,著作权归作者所有</p>

    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/javascript/" rel="tag"># javascript</a>
              <a href="/tags/node-js/" rel="tag"># node.js</a>
              <a href="/tags/%E5%85%A5%E9%97%A8/" rel="tag"># 入门</a>
              <a href="/tags/language/" rel="tag"># language</a>
              <a href="/tags/%E5%9F%BA%E7%A1%80/" rel="tag"># 基础</a>
              <a href="/tags/express/" rel="tag"># express</a>
              <a href="/tags/%E6%96%87%E6%A1%A3/" rel="tag"># 文档</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2017/04/12/JavaScript%E8%AF%A6%E8%A7%A3/" rel="prev" title="JavaScript详解">
      <i class="fa fa-chevron-left"></i> JavaScript详解
    </a></div>
      <div class="post-nav-item">
    <a href="/2017/07/29/HTML-CSS/" rel="next" title="HTML+CSS">
      HTML+CSS <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Express-4-x-API"><span class="nav-number">1.</span> <span class="nav-text">Express 4.x API</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#express"><span class="nav-number">1.1.</span> <span class="nav-text">express()</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Methods"><span class="nav-number">1.1.1.</span> <span class="nav-text">Methods</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#express-static-root-options"><span class="nav-number">1.1.1.1.</span> <span class="nav-text">express.static(root, [options])</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Application"><span class="nav-number">1.2.</span> <span class="nav-text">Application()</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Properties"><span class="nav-number">1.2.1.</span> <span class="nav-text">Properties</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#app-locals"><span class="nav-number">1.2.1.1.</span> <span class="nav-text">app.locals</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#app-mountpath"><span class="nav-number">1.2.1.2.</span> <span class="nav-text">app.mountpath</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Events"><span class="nav-number">1.2.2.</span> <span class="nav-text">Events</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#app-on-%E2%80%98mount%E2%80%99-callback-parent"><span class="nav-number">1.2.2.1.</span> <span class="nav-text">app.on(‘mount’, callback(parent))</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Methods-1"><span class="nav-number">1.2.3.</span> <span class="nav-text">Methods</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#app-all-path-callback-callback-%E2%80%A6"><span class="nav-number">1.2.3.1.</span> <span class="nav-text">app.all(path, callback[, callback …]</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#app-delete-path-callback-callback-%E2%80%A6"><span class="nav-number">1.2.3.2.</span> <span class="nav-text">app.delete(path, callback[, callback …])</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#app-disable-name"><span class="nav-number">1.2.3.3.</span> <span class="nav-text">app.disable(name)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#app-disabled-name"><span class="nav-number">1.2.3.4.</span> <span class="nav-text">app.disabled(name)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#app-enable-name"><span class="nav-number">1.2.3.5.</span> <span class="nav-text">app.enable(name)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#app-enabled-name"><span class="nav-number">1.2.3.6.</span> <span class="nav-text">app.enabled(name)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#app-engine-ext-callback"><span class="nav-number">1.2.3.7.</span> <span class="nav-text">app.engine(ext, callback)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#app-get-name"><span class="nav-number">1.2.3.8.</span> <span class="nav-text">app.get(name)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#app-get-path-callback-callback-%E2%80%A6"><span class="nav-number">1.2.3.9.</span> <span class="nav-text">app.get(path, callback [, callback …])</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#app-listen-port-hostname-backlog-callback"><span class="nav-number">1.2.3.10.</span> <span class="nav-text">app.listen(port, [hostname], [backlog], [callback])</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#app-METHOD-path-callback-callback-%E2%80%A6"><span class="nav-number">1.2.3.11.</span> <span class="nav-text">app.METHOD(path, callback [, callback …])</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#app-param-name-callback"><span class="nav-number">1.2.3.12.</span> <span class="nav-text">app.param([name], callback)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#app-path"><span class="nav-number">1.2.3.13.</span> <span class="nav-text">app.path()</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#app-post-path-callback-callback-%E2%80%A6"><span class="nav-number">1.2.3.14.</span> <span class="nav-text">app.post(path, callback, [callback …])</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#app-put-path-callback-callback-%E2%80%A6"><span class="nav-number">1.2.3.15.</span> <span class="nav-text">app.put(path, callback, [callback …])</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#app-render-view-locals-callback"><span class="nav-number">1.2.3.16.</span> <span class="nav-text">app.render(view, [locals], callback)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#app-route-path"><span class="nav-number">1.2.3.17.</span> <span class="nav-text">app.route(path)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#app-set-name-value"><span class="nav-number">1.2.3.18.</span> <span class="nav-text">app.set(name, value)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#app-use-path-function-function%E2%80%A6"><span class="nav-number">1.2.3.19.</span> <span class="nav-text">app.use([path,], function [, function…])</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Request"><span class="nav-number">1.3.</span> <span class="nav-text">Request</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Properties-1"><span class="nav-number">1.3.1.</span> <span class="nav-text">Properties</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#req-app"><span class="nav-number">1.3.1.1.</span> <span class="nav-text">req.app</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#req-baseUrl"><span class="nav-number">1.3.1.2.</span> <span class="nav-text">req.baseUrl</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#req-body"><span class="nav-number">1.3.1.3.</span> <span class="nav-text">req.body</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#req-cookies"><span class="nav-number">1.3.1.4.</span> <span class="nav-text">req.cookies</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#req-fresh"><span class="nav-number">1.3.1.5.</span> <span class="nav-text">req.fresh</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#req-hostname"><span class="nav-number">1.3.1.6.</span> <span class="nav-text">req.hostname</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#req-ips"><span class="nav-number">1.3.1.7.</span> <span class="nav-text">req.ips</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#req-originalUrl"><span class="nav-number">1.3.1.8.</span> <span class="nav-text">req.originalUrl</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#req-params"><span class="nav-number">1.3.1.9.</span> <span class="nav-text">req.params</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#req-path"><span class="nav-number">1.3.1.10.</span> <span class="nav-text">req.path</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#req-protocol"><span class="nav-number">1.3.1.11.</span> <span class="nav-text">req.protocol</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#req-query"><span class="nav-number">1.3.1.12.</span> <span class="nav-text">req.query</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#req-route"><span class="nav-number">1.3.1.13.</span> <span class="nav-text">req.route</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#req-secure"><span class="nav-number">1.3.1.14.</span> <span class="nav-text">req.secure</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#req-signedCookies"><span class="nav-number">1.3.1.15.</span> <span class="nav-text">req.signedCookies</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#req-stale"><span class="nav-number">1.3.1.16.</span> <span class="nav-text">req.stale</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#req-subdomains"><span class="nav-number">1.3.1.17.</span> <span class="nav-text">req.subdomains</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#req-xhr"><span class="nav-number">1.3.1.18.</span> <span class="nav-text">req.xhr</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Methods-2"><span class="nav-number">1.3.2.</span> <span class="nav-text">Methods</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#req-accepts-types"><span class="nav-number">1.3.2.1.</span> <span class="nav-text">req.accepts(types)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#req-acceptsCharsets-charset-%E2%80%A6"><span class="nav-number">1.3.2.2.</span> <span class="nav-text">req.acceptsCharsets(charset[, …])</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#req-acceptsEncodings-encoding-%E2%80%A6"><span class="nav-number">1.3.2.3.</span> <span class="nav-text">req.acceptsEncodings(encoding[, …])</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#req-acceptsLanguages-lang-%E2%80%A6"><span class="nav-number">1.3.2.4.</span> <span class="nav-text">req.acceptsLanguages(lang [, …])</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#req-get-field"><span class="nav-number">1.3.2.5.</span> <span class="nav-text">req.get(field)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#req-is-type"><span class="nav-number">1.3.2.6.</span> <span class="nav-text">req.is(type)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#req-param-naem-defaultValue"><span class="nav-number">1.3.2.7.</span> <span class="nav-text">req.param(naem, [, defaultValue])</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Response"><span class="nav-number">1.4.</span> <span class="nav-text">Response</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Properties-2"><span class="nav-number">1.4.1.</span> <span class="nav-text">Properties</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#res-app"><span class="nav-number">1.4.1.1.</span> <span class="nav-text">res.app</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#res-headersSent"><span class="nav-number">1.4.1.2.</span> <span class="nav-text">res.headersSent</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#res-locals"><span class="nav-number">1.4.1.3.</span> <span class="nav-text">res.locals</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Methods-3"><span class="nav-number">1.4.2.</span> <span class="nav-text">Methods</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#res-append-field-value"><span class="nav-number">1.4.2.1.</span> <span class="nav-text">res.append(field [, value])</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#res-attachment-filename"><span class="nav-number">1.4.2.2.</span> <span class="nav-text">res.attachment([filename])</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#res-cookie-name-value-options"><span class="nav-number">1.4.2.3.</span> <span class="nav-text">res.cookie(name, value [,options])</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#res-clearCookie-name-options"><span class="nav-number">1.4.2.4.</span> <span class="nav-text">res.clearCookie(name [,options])</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#res-download-path-filename-fn"><span class="nav-number">1.4.2.5.</span> <span class="nav-text">res.download(path, [,filename], [,fn])</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#res-end-data-encoding"><span class="nav-number">1.4.2.6.</span> <span class="nav-text">res.end([data] [, encoding])</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#res-format-object"><span class="nav-number">1.4.2.7.</span> <span class="nav-text">res.format(object)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#res-get-field"><span class="nav-number">1.4.2.8.</span> <span class="nav-text">res.get(field)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#res-json-body"><span class="nav-number">1.4.2.9.</span> <span class="nav-text">res.json([body])</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#res-jsonp-body"><span class="nav-number">1.4.2.10.</span> <span class="nav-text">res.jsonp([body])</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#res-links-links"><span class="nav-number">1.4.2.11.</span> <span class="nav-text">res.links(links)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#res-location-path"><span class="nav-number">1.4.2.12.</span> <span class="nav-text">res.location(path)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#res-redirect-status-path"><span class="nav-number">1.4.2.13.</span> <span class="nav-text">res.redirect([status,] path)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#res-render-view-locals-callback"><span class="nav-number">1.4.2.14.</span> <span class="nav-text">res.render(view [, locals] [, callback])</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#res-send-body"><span class="nav-number">1.4.2.15.</span> <span class="nav-text">res.send([body])</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#res-sendFile-path-options-fn"><span class="nav-number">1.4.2.16.</span> <span class="nav-text">res.sendFile(path [, options] [, fn])</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#res-sendStatus-statusCode"><span class="nav-number">1.4.2.17.</span> <span class="nav-text">res.sendStatus(statusCode)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#res-set-field-value"><span class="nav-number">1.4.2.18.</span> <span class="nav-text">res.set(field [, value])</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#res-status-code"><span class="nav-number">1.4.2.19.</span> <span class="nav-text">res.status(code)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#res-type-type"><span class="nav-number">1.4.2.20.</span> <span class="nav-text">res.type(type)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#res-vary-field"><span class="nav-number">1.4.2.21.</span> <span class="nav-text">res.vary(field)</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Router"><span class="nav-number">1.5.</span> <span class="nav-text">Router</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Router-options"><span class="nav-number">1.5.1.</span> <span class="nav-text">Router([options])</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Methods-4"><span class="nav-number">1.5.2.</span> <span class="nav-text">Methods</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#router-all-path-callback-%E2%80%A6-callback"><span class="nav-number">1.5.2.1.</span> <span class="nav-text">router.all(path, [callback, …] callback)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#router-METHOD-path-callback-%E2%80%A6-callback"><span class="nav-number">1.5.2.2.</span> <span class="nav-text">router.METHOD(path, [callback, …] callback)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#router-param-name-callback"><span class="nav-number">1.5.2.3.</span> <span class="nav-text">router.param(name, callback)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#router-route-path"><span class="nav-number">1.5.2.4.</span> <span class="nav-text">router.route(path)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#router-use-path-function-%E2%80%A6-function"><span class="nav-number">1.5.2.5.</span> <span class="nav-text">router.use([path], [function, …] function)</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#express-%E4%B8%AD%E5%B8%B8%E7%94%A8%E4%B8%AD%E9%97%B4%E4%BB%B6"><span class="nav-number">2.</span> <span class="nav-text">express 中常用中间件</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%A7%A3%E6%9E%90%E8%AF%B7%E6%B1%82%E4%BD%93%E7%9A%84%E4%B8%AD%E9%97%B4%E4%BB%B6"><span class="nav-number">2.1.</span> <span class="nav-text">解析请求体的中间件</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#body-parser%E4%B8%AD%E9%97%B4%E4%BB%B6"><span class="nav-number">2.1.1.</span> <span class="nav-text">body-parser中间件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Multer-%E4%B8%AD%E9%97%B4%E4%BB%B6"><span class="nav-number">2.1.2.</span> <span class="nav-text">Multer 中间件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Formidable-%E4%B8%AD%E9%97%B4%E4%BB%B6"><span class="nav-number">2.1.3.</span> <span class="nav-text">Formidable 中间件</span></a></li></ol></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">xuefeng</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">28</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
        <span class="site-state-item-count">12</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">59</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">xuefeng</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://mist.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Mist</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
