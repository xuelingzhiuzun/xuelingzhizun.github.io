<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Mist","version":"7.8.0","exturl":false,"sidebar":{"position":"right","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="Mongoose 用于操作mongoDB的工具，mongodb提供的原驱动也可以，但是较难操作，故使用mongoose">
<meta property="og:type" content="article">
<meta property="og:title" content="Mongoose">
<meta property="og:url" content="http://example.com/2016/12/11/Mongoose/index.html">
<meta property="og:site_name" content="XFNOTES">
<meta property="og:description" content="Mongoose 用于操作mongoDB的工具，mongodb提供的原驱动也可以，但是较难操作，故使用mongoose">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2016-12-11T07:33:00.000Z">
<meta property="article:modified_time" content="2018-01-07T11:40:14.000Z">
<meta property="article:author" content="xuefeng">
<meta property="article:tag" content="node">
<meta property="article:tag" content="mongoDB">
<meta property="article:tag" content="NOSQL">
<meta property="article:tag" content="数据库">
<meta property="article:tag" content="mongoose">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://example.com/2016/12/11/Mongoose/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>Mongoose | XFNOTES</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">XFNOTES</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-ategories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>ategories</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2016/12/11/Mongoose/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="xuefeng">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="XFNOTES">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Mongoose
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2016-12-11 15:33:00" itemprop="dateCreated datePublished" datetime="2016-12-11T15:33:00+08:00">2016-12-11</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2018-01-07 19:40:14" itemprop="dateModified" datetime="2018-01-07T19:40:14+08:00">2018-01-07</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/mongoDB/" itemprop="url" rel="index"><span itemprop="name">mongoDB</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>Mongoose 用于操作mongoDB的工具，mongodb提供的原驱动也可以，但是较难操作，故使用mongoose</p>
<a id="more"></a>
<h1 id="Mongoose-入门参考"><a href="#Mongoose-入门参考" class="headerlink" title="Mongoose 入门参考"></a>Mongoose 入门参考</h1><h2 id="转载说明"><a href="#转载说明" class="headerlink" title="转载说明"></a>转载说明</h2><p>源于<a target="_blank" rel="noopener" href="https://cnodejs.org/topic/504b4924e2b84515770103dd">Mongoose学习参考文档——基础篇</a><br>源于<a target="_blank" rel="noopener" href="https://cnodejs.org/topic/548e54d157fd3ae46b233502">Node.js 手册查询-3-Mongoose 方法</a></p>
<h2 id="名词解释"><a href="#名词解释" class="headerlink" title="名词解释"></a>名词解释</h2><ul>
<li>Schema  ：  一种以文件形式存储的数据库模型骨架，不具备数据库的操作能力</li>
<li>Model   ：  由Schema发布生成的模型，具有抽象属性和行为的数据库操作对</li>
<li>Entity  ：  由Model创建的实体，他的操作也会影响数据库</li>
</ul>
<p><strong>约定</strong></p>
<ol>
<li><p>本学习文档采用严格命名方式来区别不同对象，例如：</p>
<ul>
<li><code>var PersonSchema;</code>   //Person的文本属性</li>
<li><code>var PersonModel;</code>    //Person的数据库模型</li>
<li><code>var PersonEntity;</code>   //Person实体</li>
</ul>
</li>
<li><p>Schema、Model、Entity的关系请牢记，Schema生成Model，Model创造Entity，Model和Entity都可对数据库操作造成影响，但Model比Entity更具操作性。</p>
</li>
</ol>
<h3 id="Schema"><a href="#Schema" class="headerlink" title="Schema"></a>Schema</h3><p>一种以文件形式存储的数据库模型骨架，无法直接通往数据库端，也就是说它不具备对数据库的操作能力.可以说是数据属性模型(传统意义的表结构)，又或着是“集合”的模型骨架</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;* 定义一个 Schema *&#x2F;</span><br><span class="line">var mongoose &#x3D; require(&quot;mongoose&quot;);</span><br><span class="line"></span><br><span class="line">var TestSchema &#x3D; new mongoose.Schema(&#123;</span><br><span class="line">    name : &#123; type:String &#125;,&#x2F;&#x2F;属性name,类型为String</span><br><span class="line">    age  : &#123; type:Number, default:0 &#125;,&#x2F;&#x2F;属性age,类型为Number,默认为0</span><br><span class="line">    time : &#123; type:Date, default:Date.now &#125;,</span><br><span class="line">    email: &#123; type:String,default:&#39;&#39;&#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>上面这个 TestSchema包含4个属性 [name, age, time, email]</p>
<h3 id="Model"><a href="#Model" class="headerlink" title="Model"></a>Model</h3><p>由Schema构造生成的模型，除了Schema定义的数据库骨架以外，还具有数据库操作的行为，类似于管理数据库属性、行为的类</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">var db &#x3D; mongoose.connect(&quot;mongodb:&#x2F;&#x2F;127.0.0.1:27017&#x2F;test&quot;);</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; 创建Model</span><br><span class="line">var TestModel &#x3D; db.model(&quot;test1&quot;, TestSchema);</span><br><span class="line">test1 数据库中的集合名称, 不存在会创建.</span><br></pre></td></tr></table></figure>
<h3 id="Entity"><a href="#Entity" class="headerlink" title="Entity"></a>Entity</h3><p>由Model创建的实体，使用save方法保存数据，Model和Entity都有能影响数据库的操作，但Model比Entity更具操作性</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">var TestEntity &#x3D; new TestModel(&#123;</span><br><span class="line">       name : &quot;Lenka&quot;,</span><br><span class="line">       age  : 36,</span><br><span class="line">       email: &quot;lenka@qq.com&quot;</span><br><span class="line">&#125;);</span><br><span class="line">console.log(TestEntity.name); &#x2F;&#x2F; Lenka</span><br><span class="line">console.log(TestEntity.age); &#x2F;&#x2F; 36</span><br></pre></td></tr></table></figure>
<h2 id="可以使用的数据类型"><a href="#可以使用的数据类型" class="headerlink" title="可以使用的数据类型"></a>可以使用的数据类型</h2><p>数据库存储的各种数据是需要预先设置其数据类型的，并且需要在Scheme中设置，我们称这些数据类型为<code>Scheme.Type</code>。</p>
<p><code>Schema.Type</code>是由Mongoose内定的一些数据类型，基本数据类型都在其中，他也内置了一些Mongoose特有的<code>Schema.Type</code>。当然，你也可以自定义<code>Schema.Type</code>，只有满足<code>Schema.Type</code>的类型才能定义在Schema内。</p>
<p>例如:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">var ExampleSchema &#x3D; new Schema(&#123;</span><br><span class="line">      name:String,</span><br><span class="line">      binary:Buffer,</span><br><span class="line">      living:Boolean,</span><br><span class="line">      updated:Date,</span><br><span class="line">      age:Number,</span><br><span class="line">      mixed:Schema.Types.Mixed, &#x2F;&#x2F;该混合类型等同于nested</span><br><span class="line">      _id:Schema.Types.ObjectId,  &#x2F;&#x2F;主键</span><br><span class="line">      _fk:Schema.Types.ObjectId,  &#x2F;&#x2F;外键</span><br><span class="line">      array:[],</span><br><span class="line">      arrOfString:[String],</span><br><span class="line">      arrOfNumber:[Number],</span><br><span class="line">      arrOfDate:[Date],</span><br><span class="line">      arrOfBuffer:[Buffer],</span><br><span class="line">      arrOfBoolean:[Boolean],</span><br><span class="line">      arrOfMixed:[Schema.Types.Mixed],</span><br><span class="line">      arrOfObjectId:[Schema.Types.ObjectId]</span><br><span class="line">      nested:&#123;</span><br><span class="line">        stuff:String,</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br></pre></td></tr></table></figure>
<h3 id="关于Buffer"><a href="#关于Buffer" class="headerlink" title="关于Buffer"></a>关于Buffer</h3><p>Buffer和ArrayBuffer是Nodejs两种隐藏的对象，相关内容请查看NodeJS-API</p>
<h3 id="关于Mixed"><a href="#关于Mixed" class="headerlink" title="关于Mixed"></a>关于Mixed</h3><p>Schema.Types.Mixed是Mongoose定义个混合类型，该混合类型如果未定义具体形式。因此,如果定义具体内容，就直接使用{}来定义，以下两句等价</p>
<pre><code>var AnySchema = new Schema(&#123;any:&#123;&#125;&#125;);
var AnySchema = new Schema(&#123;any:Schema.Types.Mixed&#125;);</code></pre>
<p>混合类型因为没有特定约束，因此可以任意修改，一旦修改了原型，则必须调用markModified()</p>
<pre><code>person.anything = &#123;x:[3,4,&#123;y:&#39;change&#39;&#125;]&#125;
person.markModified(&#39;anything&#39;);//传入anything，表示该属性类型发生变化
person.save();</code></pre>
<h3 id="关于ObjectId"><a href="#关于ObjectId" class="headerlink" title="关于ObjectId"></a>关于ObjectId</h3><p>存储在mongodb集合中的每个文档（document）都有一个默认的主键_id，这个主键名称是固定的，它可以是mongodb支持的任何数据类型，默认是ObjectId。除非自己定义，方可覆盖</p>
<p>ObjectId是一个12字节的 BSON 类型字符串。按照字节顺序，依次代表：</p>
<ul>
<li>4字节：UNIX时间戳</li>
<li>3字节：表示运行MongoDB的机器</li>
<li>2字节：表示生成此_id的进程</li>
<li>3字节：由一个随机数开始的计数器生成的值<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">var mongoose &#x3D; require(&#39;mongoose&#39;);</span><br><span class="line">var ObjectId &#x3D; mongoose.Schema.Types.ObjectId;</span><br><span class="line">var StudentSchema &#x3D; new Schema(&#123;&#125;); &#x2F;&#x2F;默认会有_id:ObjectId</span><br><span class="line">var TeacherSchema &#x3D; new Schema(&#123;id:ObjectId&#125;);&#x2F;&#x2F;只有id:ObjectId</span><br></pre></td></tr></table></figure>
该类型的值由系统自己生成，从某种意义上几乎不会重复，生成过程比较复杂，有兴趣的朋友可以查看源码。</li>
</ul>
<h3 id="关于Array"><a href="#关于Array" class="headerlink" title="关于Array"></a>关于Array</h3><p>Array在JavaScript编程语言中并不是数组，而是集合，因此里面可以存入不同的值，以下代码等价：</p>
<pre><code>var ExampleSchema1 = new Schema(&#123;array:[]&#125;);
var ExampleSchema2 = new Schema(&#123;array:Array&#125;);
var ExampleSchema3 = new Schema(&#123;array:[Schema.Types.Mixed]&#125;);
var ExampleSchema4 = new Schema(&#123;array:[&#123;&#125;]&#125;);</code></pre>
<h3 id="附言"><a href="#附言" class="headerlink" title="附言"></a>附言</h3><p>Schema不仅定义了文档结构和使用性能，还可以有扩展插件、实例方法、静态方法、复合索引、文档生命周期钩子</p>
<p>Schema可以定义插件，并且插件具有良好的可拔插性，请有兴趣的读者继续往后阅读或者查阅官方资料。</p>
<h2 id="API"><a href="#API" class="headerlink" title="API"></a>API</h2><h3 id="连接接数据库"><a href="#连接接数据库" class="headerlink" title="连接接数据库"></a>连接接数据库</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">var mongoose &#x3D; require(&quot;mongoose&quot;);</span><br><span class="line">var db &#x3D; mongoose.connect(&quot;mongodb:&#x2F;&#x2F;localhost:27017&#x2F;test&quot;);</span><br></pre></td></tr></table></figure>
<h3 id="db-数据库操作"><a href="#db-数据库操作" class="headerlink" title="db - 数据库操作"></a>db - 数据库操作</h3><p>挂接数据库连接事件,参数1: 也可以是error.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.connection.on(‘open’, callback);</span><br></pre></td></tr></table></figure>
<h3 id="Schema-表结构"><a href="#Schema-表结构" class="headerlink" title="Schema - 表结构"></a>Schema - 表结构</h3><p>1.构造函数</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">new mongoose.Schema( &#123; name:&#123;type:String&#125;, age:&#123;type:Number, default:10&#125;  &#125; )</span><br></pre></td></tr></table></figure>
<p>2.添加属性</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Schema.add( &#123; name: ‘String’, email: ‘String’, age: ‘Number’ &#125; )</span><br></pre></td></tr></table></figure>
<p>3.有时候Schema不仅要为后面的Model和Entity提供公共的属性，还要提供公共的方法</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"> Schema.method( ‘say’, function()&#123;console.log(‘hello’);&#125; )</span><br><span class="line">&#x2F;&#x2F;这样Model和Entity的实例就能使用这个方法了</span><br></pre></td></tr></table></figure>
<p>4.添加静态方法</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"> Schema.static( ‘say’, function()&#123;console.log(‘hello’);&#125; )</span><br><span class="line">&#x2F;&#x2F;静态方法，只限于在Model层就能使用</span><br></pre></td></tr></table></figure>
<p>5.追加方法</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"> Schema.methods.say &#x3D; function()&#123;console.log(‘hello’);&#125;;</span><br><span class="line">&#x2F;&#x2F;静态方法，只限于在Model层就能使用</span><br></pre></td></tr></table></figure>
<h3 id="model-文档操作"><a href="#model-文档操作" class="headerlink" title="model - 文档操作"></a>model - 文档操作</h3><p>1.构造函数, 参数1:集合名称, 参数2:Schema实例</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.model(“test1”, TestSchema );</span><br></pre></td></tr></table></figure>
<p>2.查询, 参数1忽略,或为空对象则返回所有集合文档</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">model.find(&#123;&#125;, callback);</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">model.find(&#123;&#125;,field,callback);</span><br><span class="line">&#x2F;&#x2F;过滤查询,参数2: &#123;‘name’:1, ‘age’:0&#125; 查询文档的返回结果包含name , 不包含age.(_id默认是1)</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">model.find(&#123;&#125;,null,&#123;limit:20&#125;);</span><br><span class="line">&#x2F;&#x2F;过滤查询,参数3: 游标操作 limit限制返回结果数量为20个,如不足20个则返回所有.</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">model.findOne(&#123;&#125;, callback);</span><br><span class="line">&#x2F;&#x2F;查询找到的第一个文档</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">model.findById(‘obj._id’, callback);</span><br><span class="line">&#x2F;&#x2F;查询找到的第一个文档,同上. 但是只接受 __id 的值查询</span><br></pre></td></tr></table></figure>
<p>3.创建, 在集合中创建一个文档</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Model.create(文档数据, callback))</span><br></pre></td></tr></table></figure>
<p>4.更新,参数1:查询条件, 参数2:更新对象,可以使用MondoDB的更新修改器</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Model.update(conditions, update, function(error)</span><br></pre></td></tr></table></figure>
<p>5.删除, 参数1:查询条件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Model.remove(conditions,callback);</span><br></pre></td></tr></table></figure>
<h3 id="Entity-文档操作"><a href="#Entity-文档操作" class="headerlink" title="Entity - 文档操作"></a>Entity - 文档操作</h3><p>1.构造函数, 其实就是model的实例</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">new TestModel( &#123; name:‘xueyou’, age:21 &#125; );</span><br></pre></td></tr></table></figure>
<p>2.创建, 在集合中创建一个文档.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Entity.save(callback);</span><br></pre></td></tr></table></figure>
<h2 id="CRUD进一步说明"><a href="#CRUD进一步说明" class="headerlink" title="CRUD进一步说明"></a>CRUD进一步说明</h2><h3 id="查询"><a href="#查询" class="headerlink" title="查询"></a>查询</h3><p>通常有2种查询方式，一种是直接查询，一种是链式查询（2种查询都是自己命名的）</p>
<h4 id="直接查询"><a href="#直接查询" class="headerlink" title="直接查询"></a>直接查询</h4><p>在查询时带有回调函数的，称之为直接查询，查询的条件往往通过API来设定，例如：</p>
<pre><code>PersonModel.findOne(&#123;&#39;name.last&#39;:&#39;dragon&#39;&#125;,&#39;some select&#39;,function(err,person)&#123;
  //如果err==null，则person就能取到数据
&#125;);</code></pre>
<p>具体的查询参数，请查询API</p>
<h4 id="链式查询"><a href="#链式查询" class="headerlink" title="链式查询"></a>链式查询</h4><p>在查询时候，不带回调，而查询条件通过API函数来制定，例如：</p>
<pre><code>var query = PersonModel.findOne(&#123;&#39;name.last&#39;:&#39;dragon&#39;&#125;);
query.select(&#39;some select&#39;);
query.exec(function(err,pserson)&#123;
//如果err==null，则person就能取到数据</code></pre>
<p>  });<br>这种方式相对直接查询，分的比较明细，如果不带callback，则返回query，query没有执行的预编译查询语句，该query对象执行的方法都将返回自己，只有在执行exec方法时才执行查询，而且必须有回调。</p>
<p>因为query的操作始终返回自身，我们可以采用更形象的链式写法</p>
<pre><code>Person
  .find(&#123; occupation: /host/ &#125;)
  .where(&#39;name.last&#39;).equals(&#39;Ghost&#39;)
  .where(&#39;age&#39;).gt(17).lt(66)
  .where(&#39;likes&#39;).in([&#39;vaporizing&#39;, &#39;talking&#39;])
  .limit(10)
  .sort(&#39;-occupation&#39;)
  .select(&#39;name occupation&#39;)
  .exec(callback);</code></pre>
<h3 id="更新"><a href="#更新" class="headerlink" title="更新"></a>更新</h3><p>有许多方式来更新文件，以下是常用的传统方式：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">PersonModel.findById(id,function(err,person)&#123;</span><br><span class="line">  person.name &#x3D; &#39;MDragon&#39;;</span><br><span class="line">  person.save(function(err)&#123;&#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>这里，利用Model模型查询到了person对象，该对象属于Entity，可以有save操作，如果使用Model`操作，需注意：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">PersonModel.findById(id,function(err,person)&#123;</span><br><span class="line">  person.name &#x3D; &#39;MDragon&#39;;</span><br><span class="line">  var _id &#x3D; person._id; &#x2F;&#x2F;需要取出主键_id</span><br><span class="line">  delete person._id;    &#x2F;&#x2F;再将其删除</span><br><span class="line">  PersonModel.update(&#123;_id:_id&#125;,person,function(err)&#123;&#125;);</span><br><span class="line">  &#x2F;&#x2F;此时才能用Model操作，否则报错</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p><code>update</code>第一个参数是查询条件，第二个参数是更新的对象，但不能更新主键，这就是为什么要删除主键的原因。</p>
<p>当然这样的更新很麻烦，可以使用$set属性来配置，这样也不用先查询，如果更新的数据比较少，可用性还是很好的：</p>
<pre><code>PersonModel.update(&#123;_id:_id&#125;,&#123;$set:&#123;name:&#39;MDragon&#39;&#125;&#125;,function(err)&#123;&#125;);</code></pre>
<p>需要注意，Document的CRUD操作都是异步执行，callback第一个参数必须是err，而第二个参数各个方法不一样，update的callback第二个参数是更新的数量，如果要返回更新后的对象，则要使用如下方法</p>
<pre><code>Person.findByIdAndUpdate(_id,&#123;$set:&#123;name:&#39;MDragon&#39;&#125;&#125;,function(err,person)&#123;
  console.log(person.name); //MDragon
&#125;);</code></pre>
<p>类似的方法还有findByIdAndRemove，如同名字，只能根据id查询并作update/remove操作，操作的数据仅一条</p>
<h3 id="新增"><a href="#新增" class="headerlink" title="新增"></a>新增</h3><p>如果是Entity，使用save方法，如果是Model，使用create方法</p>
<pre><code>//使用Entity来增加一条数据
var krouky = new PersonModel(&#123;name:&#39;krouky&#39;&#125;);
krouky.save(callback);
//使用Model来增加一条数据
var MDragon = &#123;name:&#39;MDragon&#39;&#125;;
PersonModel.create(MDragon,callback);</code></pre>
<p>两种新增方法区别在于，如果使用Model新增时，传入的对象只能是纯净的JSON对象，不能是由Model创建的实体，原因是：由Model创建的实体krouky虽然打印是只有<code>&#123;name:&#39;krouky&#39;&#125;</code>，但是krouky属于Entity，包含有Schema属性和Model数据库行为模型。如果是使用Model创建的对象，传入时一定会将隐藏属性也存入数据库，虽然3.x追加了默认严格属性，但也不必要增加操作的报错</p>
<h3 id="删除"><a href="#删除" class="headerlink" title="删除"></a>删除</h3><p>和新增一样，删除也有2种方式，但Entity和Model都使用remove方法</p>
<h2 id="Sub-Docs"><a href="#Sub-Docs" class="headerlink" title="Sub Docs"></a>Sub Docs</h2><p>如同SQL数据库中2张表有主外关系，Mongoose将2个Document的嵌套叫做Sub-Docs（子文档）</p>
<p>简单的说就是一个Document嵌套另外一个Document或者Documents:</p>
<pre><code>var ChildSchema1 = new Schema(&#123;name:String&#125;);
var ChildSchema2 = new Schema(&#123;name:String&#125;);
var ParentSchema = new Schema(&#123;
  children1:ChildSchema1,   //嵌套Document
  children2:[ChildSchema2]  //嵌套Documents
&#125;);</code></pre>
<p>Sub-Docs享受和Documents一样的操作，但是Sub-Docs的操作都由父类去执行</p>
<pre><code>var ParentModel = db.model(&#39;Parent&#39;,parentSchema);
var parent = new ParentModel(&#123;
  children2:[&#123;name:&#39;c1&#39;&#125;,&#123;name:&#39;c2&#39;&#125;]
&#125;);
parent.children2[0].name = &#39;d&#39;;
parent.save(callback);</code></pre>
<p>parent在执行保存时，由于包含children2，他是一个数据库模型对象，因此会先保存chilren2[0]和chilren2[1]。</p>
<p>如果子文档在更新时出现错误，将直接报在父类文档中，可以这样处理：</p>
<pre><code>ChildrenSchema.pre(&#39;save&#39;,function(next)&#123;
  if(&#39;x&#39; === this.name) return next(new Error(&#39;#err:not-x&#39;));
  next();
&#125;);
var parent = new ParentModel(&#123;children1:&#123;name:&#39;not-x&#39;&#125;&#125;);
parent.save(function(err)&#123;
  console.log(err.message); //#err:not-x
&#125;);</code></pre>
<h3 id="查询子文档"><a href="#查询子文档" class="headerlink" title="查询子文档"></a>查询子文档</h3><p>如果children是parent的子文档，可以通过如下方法查询到children</p>
<pre><code>var child = parent.children.id(id);</code></pre>
<h3 id="新增、删除、更新"><a href="#新增、删除、更新" class="headerlink" title="新增、删除、更新"></a>新增、删除、更新</h3><p>子文档是父文档的一个属性，因此按照属性的操作即可，不同的是在新增父类的时候，子文档是会被先加入进去的。</p>
<p>如果ChildrenSchema是临时的一个子文档，不作为数据库映射集合，可以这样：</p>
<pre><code>var ParentSchema = new Schema(&#123;
  children:&#123;
    name:String
  &#125;
&#125;);
//其实就是匿名混合模式</code></pre>
<h3 id="修改器和更新器"><a href="#修改器和更新器" class="headerlink" title="修改器和更新器"></a>修改器和更新器</h3><h4 id="更新修改器"><a href="#更新修改器" class="headerlink" title="更新修改器:"></a>更新修改器:</h4><ul>
<li><p>‘$inc’ 增减修改器,只对数字有效.下面的实例: 找到 age=22的文档,修改文档的age值自增1</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Model.update(&#123;‘age’:22&#125;, &#123;’$inc’:&#123;‘age’:1&#125; &#125;  );</span><br><span class="line">&#x2F;&#x2F;执行后: age&#x3D;23</span><br></pre></td></tr></table></figure></li>
<li><p>‘$set’ 指定一个键的值,这个键不存在就创建它.可以是任何MondoDB支持的类型.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Model.update(&#123;‘age’:22&#125;, &#123;’$set’:&#123;‘age’:‘haha’&#125; &#125;  );</span><br><span class="line">&#x2F;&#x2F;执行后: age&#x3D;‘haha’</span><br></pre></td></tr></table></figure></li>
<li><p>‘$unset’ 同上取反,删除一个键</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Model.update(&#123;‘age’:22&#125;, &#123;’$unset’:&#123;‘age’:‘haha’&#125; &#125;  );</span><br><span class="line">&#x2F;&#x2F;执行后: age键不存在</span><br></pre></td></tr></table></figure>
<h4 id="数组修改器"><a href="#数组修改器" class="headerlink" title="数组修改器:"></a>数组修改器:</h4></li>
<li><p>‘$push’ 给一个键push一个数组成员,键不存在会创建</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Model.update(&#123;‘age’:22&#125;, &#123;’$push’:&#123;‘array’:10&#125; &#125;  );</span><br><span class="line">&#x2F;&#x2F;执行后: 增加一个 array 键,类型为数组, 有一个成员 10</span><br></pre></td></tr></table></figure></li>
<li><p>‘$addToSet’ 向数组中添加一个元素,如果存在就不添加</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Model.update(&#123;‘age’:22&#125;, &#123;’$addToSet’:&#123;‘array’:10&#125; &#125;  );</span><br><span class="line">&#x2F;&#x2F;执行后: array中有10所以不会添加</span><br></pre></td></tr></table></figure></li>
<li><p>‘$each’ 遍历数组, 和 $push 修改器配合可以插入多个值</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Model.update(&#123;‘age’:22&#125;, &#123;’$push’:&#123;‘array’:&#123;’$each’: [1,2,3,4,5]&#125;&#125; &#125;  );</span><br><span class="line">&#x2F;&#x2F;执行后: array : [10,1,2,3,4,5]</span><br></pre></td></tr></table></figure></li>
<li><p>‘$pop’ 向数组中尾部删除一个元素</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Model.update(&#123;‘age’:22&#125;, &#123;’$pop’:&#123;‘array’:1&#125; &#125;  );</span><br><span class="line">&#x2F;&#x2F;执行后: array : [10,1,2,3,4]  tips: 将1改成-1可以删除数组首部元素</span><br></pre></td></tr></table></figure></li>
<li><p>‘$pull’ 向数组中删除指定元素</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Model.update(&#123;‘age’:22&#125;, &#123;’$pull’:&#123;‘array’:10&#125; &#125;  );</span><br><span class="line">&#x2F;&#x2F;执行后: array : [1,2,3,4]  匹配到array中的10后将其删除</span><br></pre></td></tr></table></figure>
<h4 id="条件查询"><a href="#条件查询" class="headerlink" title="条件查询:"></a>条件查询:</h4></li>
</ul>
<p>“$lt”    小于<br>“$lte”    小于等于<br>“$gt”    大于<br>“$gte”    大于等于<br>“$ne”    不等于<br> Model.find({“age”:{ “$get”:18 , “$lte”:30 } } );<br>查询 age 大于等于18并小于等于30的文档</p>
<h4 id="或查询-OR"><a href="#或查询-OR" class="headerlink" title="或查询 OR:"></a>或查询 OR:</h4><p>‘$in’ 一个键对应多个值<br>‘$nin’ 同上取反, 一个键不对应指定值<br>“$or” 多个条件匹配, 可以嵌套 $in 使用<br>“$not”    同上取反, 查询与特定模式不匹配的文档</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Model.find(&#123;“age”:&#123; “$in”:[20,21,22.‘haha’]&#125; &#125; );</span><br><span class="line">&#x2F;&#x2F;查询 age等于20或21或21或’haha’的文档</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Model.find(&#123;&quot;$or&quot; :  [ &#123;‘age’:18&#125; , &#123;‘name’:‘xueyou’&#125; ] &#125;);</span><br><span class="line">&#x2F;&#x2F;查询 age等于18 或 name等于’xueyou’ 的文档</span><br></pre></td></tr></table></figure>
<h4 id="类型查询"><a href="#类型查询" class="headerlink" title="类型查询:"></a>类型查询:</h4><p>null 能匹配自身和不存在的值, 想要匹配键的值 为null, 就要通过  “$exists” 条件判定键值已经存在<br>“$exists” (表示是否存在的意思)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Model.find(“age” :  &#123; “$in” : [null] , “exists” : true  &#125; );</span><br><span class="line">&#x2F;&#x2F;查询 age值为null的文档</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Model.find(&#123;name: &#123;$exists: true&#125;&#125;,function(error,docs)&#123;</span><br><span class="line">  &#x2F;&#x2F;查询所有存在name属性的文档</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Model.find(&#123;telephone: &#123;$exists: false&#125;&#125;,function(error,docs)&#123;</span><br><span class="line">  &#x2F;&#x2F;查询所有不存在telephone属性的文档</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h4 id="正则表达式"><a href="#正则表达式" class="headerlink" title="正则表达式:"></a>正则表达式:</h4><p>MongoDb 使用 Prel兼容的正则表达式库来匹配正则表达式</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">find( &#123;“name” : &#x2F;joe&#x2F;i &#125; )	</span><br><span class="line">&#x2F;&#x2F;查询name为 joe 的文档, 并忽略大小写</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">find( &#123;“name” : &#x2F;joe?&#x2F;i &#125; )</span><br><span class="line">&#x2F;&#x2F;查询匹配各种大小写组合</span><br></pre></td></tr></table></figure>
<h4 id="查询数组"><a href="#查询数组" class="headerlink" title="查询数组:"></a>查询数组:</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Model.find(&#123;“array”:10&#125; );</span><br><span class="line">&#x2F;&#x2F;查询 array(数组类型)键中有10的文档,  array : [1,2,3,4,5,10]  会匹配到</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Model.find(&#123;“array[5]”:10&#125; );</span><br><span class="line">&#x2F;&#x2F;查询 array(数组类型)键中下标5对应的值是10,  array : [1,2,3,4,5,10]  会匹配到</span><br></pre></td></tr></table></figure>
<ul>
<li>‘$all’ 匹配数组中多个元素<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Model.find(&#123;“array”:[5,10]&#125; );</span><br><span class="line">&#x2F;&#x2F;查询 匹配array数组中 既有5又有10的文档</span><br></pre></td></tr></table></figure></li>
<li>‘$size’ 匹配数组长度<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Model.find(&#123;“array”:&#123;&quot;$size&quot; : 3&#125; &#125; );</span><br><span class="line">&#x2F;&#x2F;查询 匹配array数组长度为3 的文档</span><br></pre></td></tr></table></figure></li>
<li>‘$slice’ 查询子集合返回<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Model.find(&#123;“array”:&#123;&quot;$skice&quot; : 10&#125; &#125; );</span><br><span class="line">&#x2F;&#x2F;查询 匹配array数组的前10个元素</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Model.find(&#123;“array”:&#123;&quot;$skice&quot; : [5,10] &#125; &#125; );</span><br><span class="line">&#x2F;&#x2F;查询 匹配array数组的第5个到第10个元素</span><br></pre></td></tr></table></figure>
<h4 id="where"><a href="#where" class="headerlink" title="where"></a>where</h4></li>
</ul>
<p>用它可以执行任意javacript语句作为查询的一部分,如果回调函数返回 true 文档就作为结果的一部分返回</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">	find( &#123;&quot;$where&quot; : function()&#123;</span><br><span class="line">		for( var x in this )&#123;</span><br><span class="line">		 &#x2F;&#x2F;这个函数中的 this 就是文档</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		if(this.x !&#x3D;&#x3D; null &amp;&amp; this.y !&#x3D;&#x3D; null)&#123;</span><br><span class="line">		    return this.x + this.y &#x3D;&#x3D;&#x3D; 10 ? true : false;</span><br><span class="line">		&#125;else&#123;</span><br><span class="line">		    return true;</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		</span><br><span class="line">&#125;  &#125;  )</span><br></pre></td></tr></table></figure>
<p><strong>简化版本</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">find( &#123;&quot;$where&quot; :  &quot;this.x + this.y &#x3D;&#x3D;&#x3D; 10&quot; &#125; )</span><br><span class="line">find( &#123;&quot;$where&quot; : &quot; function()&#123; return this.x + this.y &#x3D;&#x3D;&#x3D;10; &#125; &quot; &#125; )</span><br></pre></td></tr></table></figure>
<h2 id="游标"><a href="#游标" class="headerlink" title="游标"></a>游标</h2><p>MongoDB 使用游标返回find的执行结果.客户端对游标的实现通常能够对最终结果进行有效的控制。可以限制结果的数量，略过部分结果，根据任意键按任意顺序的组合对结果进行各种排序，或者是执行其他一些强的操作。</p>
<ul>
<li>limit(3)    限制返回结果的数量,</li>
<li>skip(3)    跳过前3个文档,返回其余的</li>
<li>sort( {“username”:1 , “age”:-1 } )    排序 键对应文档的键名, 值代表排序方向, 1 升序, -1降序</li>
</ul>

    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/node/" rel="tag"># node</a>
              <a href="/tags/mongoDB/" rel="tag"># mongoDB</a>
              <a href="/tags/NOSQL/" rel="tag"># NOSQL</a>
              <a href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/" rel="tag"># 数据库</a>
              <a href="/tags/mongoose/" rel="tag"># mongoose</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2016/11/14/nvm/" rel="prev" title="nvm">
      <i class="fa fa-chevron-left"></i> nvm
    </a></div>
      <div class="post-nav-item">
    <a href="/2016/12/28/Node%E9%9B%B6%E6%95%A3%E9%9B%86%E5%90%88/" rel="next" title="Node零散集合">
      Node零散集合 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Mongoose-%E5%85%A5%E9%97%A8%E5%8F%82%E8%80%83"><span class="nav-number">1.</span> <span class="nav-text">Mongoose 入门参考</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%BD%AC%E8%BD%BD%E8%AF%B4%E6%98%8E"><span class="nav-number">1.1.</span> <span class="nav-text">转载说明</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%90%8D%E8%AF%8D%E8%A7%A3%E9%87%8A"><span class="nav-number">1.2.</span> <span class="nav-text">名词解释</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Schema"><span class="nav-number">1.2.1.</span> <span class="nav-text">Schema</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Model"><span class="nav-number">1.2.2.</span> <span class="nav-text">Model</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Entity"><span class="nav-number">1.2.3.</span> <span class="nav-text">Entity</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8F%AF%E4%BB%A5%E4%BD%BF%E7%94%A8%E7%9A%84%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B"><span class="nav-number">1.3.</span> <span class="nav-text">可以使用的数据类型</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%85%B3%E4%BA%8EBuffer"><span class="nav-number">1.3.1.</span> <span class="nav-text">关于Buffer</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%85%B3%E4%BA%8EMixed"><span class="nav-number">1.3.2.</span> <span class="nav-text">关于Mixed</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%85%B3%E4%BA%8EObjectId"><span class="nav-number">1.3.3.</span> <span class="nav-text">关于ObjectId</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%85%B3%E4%BA%8EArray"><span class="nav-number">1.3.4.</span> <span class="nav-text">关于Array</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%99%84%E8%A8%80"><span class="nav-number">1.3.5.</span> <span class="nav-text">附言</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#API"><span class="nav-number">1.4.</span> <span class="nav-text">API</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%BF%9E%E6%8E%A5%E6%8E%A5%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="nav-number">1.4.1.</span> <span class="nav-text">连接接数据库</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#db-%E6%95%B0%E6%8D%AE%E5%BA%93%E6%93%8D%E4%BD%9C"><span class="nav-number">1.4.2.</span> <span class="nav-text">db - 数据库操作</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Schema-%E8%A1%A8%E7%BB%93%E6%9E%84"><span class="nav-number">1.4.3.</span> <span class="nav-text">Schema - 表结构</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#model-%E6%96%87%E6%A1%A3%E6%93%8D%E4%BD%9C"><span class="nav-number">1.4.4.</span> <span class="nav-text">model - 文档操作</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Entity-%E6%96%87%E6%A1%A3%E6%93%8D%E4%BD%9C"><span class="nav-number">1.4.5.</span> <span class="nav-text">Entity - 文档操作</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#CRUD%E8%BF%9B%E4%B8%80%E6%AD%A5%E8%AF%B4%E6%98%8E"><span class="nav-number">1.5.</span> <span class="nav-text">CRUD进一步说明</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9F%A5%E8%AF%A2"><span class="nav-number">1.5.1.</span> <span class="nav-text">查询</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%9B%B4%E6%8E%A5%E6%9F%A5%E8%AF%A2"><span class="nav-number">1.5.1.1.</span> <span class="nav-text">直接查询</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%93%BE%E5%BC%8F%E6%9F%A5%E8%AF%A2"><span class="nav-number">1.5.1.2.</span> <span class="nav-text">链式查询</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9B%B4%E6%96%B0"><span class="nav-number">1.5.2.</span> <span class="nav-text">更新</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%96%B0%E5%A2%9E"><span class="nav-number">1.5.3.</span> <span class="nav-text">新增</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%A0%E9%99%A4"><span class="nav-number">1.5.4.</span> <span class="nav-text">删除</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Sub-Docs"><span class="nav-number">1.6.</span> <span class="nav-text">Sub Docs</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9F%A5%E8%AF%A2%E5%AD%90%E6%96%87%E6%A1%A3"><span class="nav-number">1.6.1.</span> <span class="nav-text">查询子文档</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%96%B0%E5%A2%9E%E3%80%81%E5%88%A0%E9%99%A4%E3%80%81%E6%9B%B4%E6%96%B0"><span class="nav-number">1.6.2.</span> <span class="nav-text">新增、删除、更新</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BF%AE%E6%94%B9%E5%99%A8%E5%92%8C%E6%9B%B4%E6%96%B0%E5%99%A8"><span class="nav-number">1.6.3.</span> <span class="nav-text">修改器和更新器</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%9B%B4%E6%96%B0%E4%BF%AE%E6%94%B9%E5%99%A8"><span class="nav-number">1.6.3.1.</span> <span class="nav-text">更新修改器:</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%95%B0%E7%BB%84%E4%BF%AE%E6%94%B9%E5%99%A8"><span class="nav-number">1.6.3.2.</span> <span class="nav-text">数组修改器:</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%9D%A1%E4%BB%B6%E6%9F%A5%E8%AF%A2"><span class="nav-number">1.6.3.3.</span> <span class="nav-text">条件查询:</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%88%96%E6%9F%A5%E8%AF%A2-OR"><span class="nav-number">1.6.3.4.</span> <span class="nav-text">或查询 OR:</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%B1%BB%E5%9E%8B%E6%9F%A5%E8%AF%A2"><span class="nav-number">1.6.3.5.</span> <span class="nav-text">类型查询:</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F"><span class="nav-number">1.6.3.6.</span> <span class="nav-text">正则表达式:</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%9F%A5%E8%AF%A2%E6%95%B0%E7%BB%84"><span class="nav-number">1.6.3.7.</span> <span class="nav-text">查询数组:</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#where"><span class="nav-number">1.6.3.8.</span> <span class="nav-text">where</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%B8%B8%E6%A0%87"><span class="nav-number">1.7.</span> <span class="nav-text">游标</span></a></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">xuefeng</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">28</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
        <span class="site-state-item-count">12</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">59</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">xuefeng</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://mist.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Mist</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
